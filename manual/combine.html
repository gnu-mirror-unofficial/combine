<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!-- This manual is for combine (version 0.4.0).

Copyright C 2002, 2003, 2004, 2013 Daniel P. Valentine.

Permission is granted to copy, distribute, and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with the Invariant Sections being "GNU Free Documentation License", no 
Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled "GNU
Free Documentation License".

 -->
<!-- Created on July 28, 2013 by texi2html 1.82
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>combine Manual 0.4.0</title>

<meta name="description" content="A reference manual for the use of the program combine to process and join files together.">
<meta name="keywords" content="combine Manual 0.4.0">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.roman {font-family:serif; font-weight:normal;}
span.sansserif {font-family:sans-serif; font-weight:normal;}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<a name="Top"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="combine-Manual"></a>
<h1 class="settitle"><code>combine</code> Manual</h1>

<p>This manual is for <code>combine</code> version 0.4.0.  It provides general information for processing data files with the combine utility.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">
 &mdash; Chapters &mdash;

</pre></th></tr><tr><td align="left" valign="top"><a href="#Overview">1. Overview of <code>combine</code></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">                           <code>combine</code> in brief.
</td></tr>
<tr><td align="left" valign="top"><a href="#Invoking-combine">2. Invoking <code>combine</code></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">                   How to run <code>combine</code>.
</td></tr>
<tr><td align="left" valign="top"><a href="#How-combine-Processes-Files">3. How <code>combine</code> Processes Files</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">        Understanding what happens behind the scenes.
</td></tr>
<tr><td align="left" valign="top"><a href="#Extending-combine">4. Extending <code>combine</code></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">                  Use GUILE, it makes thing better.
</td></tr>
<tr><td align="left" valign="top"><a href="#Applying-combine">5. Applying combine</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">                   Examples of various uses for <code>combine</code>.
</td></tr>
<tr><td align="left" valign="top"><a href="#Future-Work">6. Future Work</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#GNU-Free-Documentation-License">A. GNU Free Documentation License</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">     Copying this manual.
</td></tr>
<tr><td align="left" valign="top"><a href="#Index">Index</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">
 &mdash; Direct Access to More Detail &mdash;

Overview of <code>combine</code>

</pre></th></tr><tr><td align="left" valign="top"><a href="#Introduction">1.1 Introduction</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Reporting-Bugs">1.2 Reporting Bugs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">
Invoking <code>combine</code>

</pre></th></tr><tr><td align="left" valign="top"><a href="#General-Options">2.1 General Options</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Data-Files">2.3 Data Files</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Reference-Files">2.4 Reference Files</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Output-Files">2.5 Output Files</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Field-Specifiers">2.6 Field Specifiers</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Emulation">2.7 Emulation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">
Extending <code>combine</code>

</pre></th></tr><tr><td align="left" valign="top"><a href="#Extension-Options">4.1 Extension Options</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">                  Ways to affect processing.
</td></tr>
<tr><td align="left" valign="top"><a href="#Calendar-Functions">4.2.1 Calendar Functions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">                 Date conversion.
</td></tr>
<tr><td align="left" valign="top"><a href="#Calendar-Reference">4.2.2 Calendar Reference</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">                 Names of months and things.
</td></tr>
<tr><td align="left" valign="top"><a href="#Calendar-Parsing">4.2.3 Calendar Parsing</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">                   Taking in a string.
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">
</pre></th></tr></table>

<hr size="1">
<a name="Overview"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Introduction" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Overview-of-combine"></a>
<h1 class="chapter">1. Overview of <code>combine</code></h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Introduction">1.1 Introduction</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Reporting-Bugs">1.2 Reporting Bugs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Introduction"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Overview" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Ways-to-Use-combine" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Overview" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Overview" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Introduction-1"></a>
<h2 class="section">1.1 Introduction</h2>

<p><code>combine</code> is primarily a program for merging files on a common key.
While such things as table joins on keys are common in database systems
like MySQL, there seems to be a marked failure in the availability for
such processing on text files.  <code>combine</code> is intended to fill that
gap.
</p>
<p>Another way of looking at <code>combine</code> is as the kernel of a database
system without all the overhead (and safeguards) associated with such
systems.  The missing baggage that appeals most to me is the requirement
to load data into somebody else&rsquo;s format before working with it.
<code>combine</code>&rsquo;s design is intended to allow it to work with most data
directly from the place where it already is.
</p>
<p>In looking around for existing software that wanted to do what I wanted
to do, the closest I came was the <code>join</code> utility in GNU and other
operating systems.  <code>join</code> has some limitations that I needed
to overcome.  In particular, in matching it works on only one field each
in only two files.  For such a match, on files whose fields are
separated by a delimiter, I&rsquo;m sure that join is a more efficient choice.
Someday I&rsquo;ll test that assumption.
</p>
<p>Once I started writing the program, I had to come up with a name.  Given
that one of the earliest applications that I imagined for such a program
would be to prepare data for storage in a data warehouse, I thought to
where the things that are stored in physical warehouses come from.  At
that point, I came up with the name DataFactory.  Unfortunately, just as 
I got ready to release it, I noticed that someone else has that as a 
registered trademark.
</p>
<p>As a result, I have come up with the name <code>combine</code>.  Like the farm
implement of the same name, this program can be used to separate the wheat 
from the chaff.  I also like it because it has a similarity to <code>join</code>
reminiscent of the similarity of function.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">
 &mdash; Further Introduction &mdash;
 
</pre></th></tr><tr><td align="left" valign="top"><a href="#Ways-to-Use-combine">1.1.1 Ways to Use <code>combine</code></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Ways-to-Use-combine"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Introduction" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Encrypted-Data" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Overview" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Introduction" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Ways-to-Use-combine-1"></a>
<h3 class="subsection">1.1.1 Ways to Use <code>combine</code></h3>

<p>Here are some almost real-world applications of <code>combine</code> that may
whet your imagination for your own uses.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Encrypted-Data">1.1.1.1 Encrypted Data</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Data-Validation">1.1.1.2 Data Validation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Encrypted-Data"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Ways-to-Use-combine" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Data-Validation" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Overview" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Ways-to-Use-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Encrypted-Data-1"></a>
<h4 class="subsubsection">1.1.1.1 Encrypted Data</h4>

<p>Suppose you have a file that you would normally want to keep encrypted
(say, your customer information, which includes their credit card
numbers).  Suppose further that you occasionally receive updates of some
less sensitive information about the customers.
</p>
<p>To update the sensitive file, you could unencrypt the file, load all the
data from both files into a database, merge the data, extract the result
from the database (making sure to wipe the disk storage that was used),
and re-encrypt.  That leaves the information open to DBAs and the like
during the process, and it sure seems like a lot of steps.
</p>
<p>Using <code>combine</code> and your favorite encryption program, the data never
has to touch the disk unencrypted (except in a swap file) so casual
observers are unlikely to run across sensitive information.  In addition
an updated encrypted file can be created in one command line, piping the
input and output of the sensitive data through your encryption program.
</p>
<p>Here&rsquo;s a sample command that might do the trick.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">gpg -d &lt; secret_file \
| combine -w -o 1-300 \
              -r update_information -k 1-10 -m 1-10 -o 11-20 -p \
| gpg -e &gt; updated_secret_file
</pre></td></tr></table>


<hr size="6">
<a name="Data-Validation"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Encrypted-Data" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Reporting-Bugs" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Overview" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Ways-to-Use-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Data-Validation-1"></a>
<h4 class="subsubsection">1.1.1.2 Data Validation</h4>

<p>Another example that is often important when receiving data from the
outside world is data validation.
</p>
<p>Perhaps you receive product sales data from a number of retailers, which
you need to combine with product information you have elsewhere.  To
confirm that the file you received is valid for reporting, you might need
to check the product codes, ZIP codes, and retailer codes against your 
known valid values.
</p>
<p>All the comparisons can be done in a single command, which will result in 
a status which will flag us down if anything did not match to our lists 
of expected values.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">combine -w -o 1- \
            -r products.txt -k 1-18 -m 11-28 \
            -r zip.txt -k 1-5 -m 19-23 \
            -r customer.txt -k 1-10 -m 1-10 \
            input.txt \
  | cmp input.txt
result=$?
</pre></td></tr></table>

<p>That&rsquo;s probably enough if we are pretty sure that the incoming data is
usually clean.  If something does not match up, we can investigate by
hand.  On the other hand, if we expect to find differences a little more 
frequently, we can make some small changes.
</p>
<p>The following command makes the match optional, but puts a constant &rsquo;$&rsquo;
at the end of the record for each match among the three keys to be 
validated.  When there isn&rsquo;t a match, <code>combine</code> puts a space into the 
record in place of the &rsquo;$&rsquo;.  We can then search for something other
than &rsquo;$$$&rsquo; at the end of the record to know which records didn&rsquo;t match.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">combine -w -o 1- \
            -r products.txt -k 1-18 -m 11-28 -k '$' -p \
            -r zip.txt -k 1-5 -m 19-23 -k '$' -p \
            -r customer.txt -k 1-10 -m 1-10 -k '$' -p \
            input.txt \
  | grep -v '\$\$\$$' &gt; input.nomatch
</pre></td></tr></table>

<hr size="6">
<a name="Reporting-Bugs"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Data-Validation" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Overview" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Overview" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Reporting-Bugs-1"></a>
<h2 class="section">1.2 Reporting Bugs</h2>

<p>When you find a bug, please be so kind to report it in a way that will
help the maintainer to understand why it is a bug and how to make it
happen (so that the correction can be tested).  The information
necessary to make such a determination will include such things as a
description of the symptoms (not just your impression of the cause), the
command line you used to run the program, the options that were used
when building the program, and anything else that you are not absolutely
sure is irrelevant.  You can also include the things that you are
absolutely sure are irrelevant, as one is often sure without good
reason.
</p>
<p>Thank you for taking advantage of this free software.  Your information
on bugs in your use of the software are very valuable in keeping it as
useful as possible for all users.  Please report bugs to
&lt;bug-combine@gnu.org&gt;
</p>
<hr size="6">
<a name="Invoking-combine"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Reporting-Bugs" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#General-Options" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Overview" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#How-combine-Processes-Files" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Invoking-combine-1"></a>
<h1 class="chapter">2. Invoking <code>combine</code></h1>

<p><code>combine</code> is invoked with the command 
</p>
<p><code>combine [general options | data file options]&hellip; [reference file options]&hellip; [data files]</code>
</p>
<p>The various options are described in the following sections. 
</p>
<p>The arguments to the command are data files, an optional list of file
names to be processed or nothing, indicating that the input will come
from <code>stdin</code>.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#General-Options">2.1 General Options</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#File-Options">2.2 File Options</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Data-Files">2.3 Data Files</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Reference-Files">2.4 Reference Files</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Output-Files">2.5 Output Files</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Field-Specifiers">2.6 Field Specifiers</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Emulation">2.7 Emulation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="General-Options"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Invoking-combine" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#File-Options" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#How-combine-Processes-Files" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="General-Options-1"></a>
<h2 class="section">2.1 General Options</h2>
<a name="index-general-options"></a>
<a name="index-options_002c-general"></a>

<p>The general options are not specific to any particular file and apply to
the entire current run of the program.  They are listed below.
</p>
<dl compact="compact">
<dt> &lsquo;<samp>-R</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--check-all-reference</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--no-check-all-reference</samp>&rsquo;</dt>
<dd><p>For each data record, check for a match with each of the reference
files.  This option is set by default.  When turned off with
&lsquo;<samp>--no-check-all-reference</samp>&rsquo;, processing of that data file record 
will be stopped as soon as a required match is not fulfilled.  This is 
a shortcut for speed, but it will change the meaning of any flags or 
counters set in reference-file-based input.
</p>
</dd>
<dt> &lsquo;<samp>-f</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--flag</samp>&rsquo;</dt>
<dd><p>In any output based on a reference file, print a flag with the value
&lsquo;<samp>1</samp>&rsquo; if the record was matched by a data record or &lsquo;<samp>0</samp>&rsquo;
otherwise.
</p>
</dd>
<dt> &lsquo;<samp>-n</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--count</samp>&rsquo;</dt>
<dd><p>In any output based on a reference file, print a new field which is a
count of the number of data records that matched the current reference
record.
</p>
</dd>
<dt> &lsquo;<samp>-z <var>number</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--counter-size=<var>number</var></samp>&rsquo;</dt>
<dd><p>If counters or sums of data fields are being written into
reference-based output, make them <var>number</var> bytes long.
</p>
</dd>
<dt> &lsquo;<samp>--statistics</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--no-statistics</samp>&rsquo;</dt>
<dd><p>At the end of the processing, write to <code>stderr</code> counts of the
number of records read and matched from each file processed.  The option
is enabled by default.  When turned off with &lsquo;<samp>--no-statistics</samp>&rsquo;
print no statistics.
</p>
</dd>
<dt> &lsquo;<samp>--verbose</samp>&rsquo;</dt>
<dd><p>Write all the information that is possible about the processing to
<code>stderr</code>.  This includes a summary of the options that have been
set and running counters of the number of records processed.
</p>
</dd>
</dl>

<hr size="6">
<a name="File-Options"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#General-Options" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Data-Files" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#How-combine-Processes-Files" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="File-Options-1"></a>
<h2 class="section">2.2 File Options</h2>
<a name="index-file-options"></a>
<a name="index-options_002c-file"></a>
<a name="index-file-structure-options"></a>
<a name="index-options_002c-file-structure"></a>

<p>There are some attributes that apply to any file.  They include such
things as the way to tell one record from another, the way to identify
fields within a record, and the fields in a file that you want to write
out.
</p>

<dl compact="compact">
<dt> &lsquo;<samp>-d <var>string</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--output-field-delimiter=<var>string</var></samp>&rsquo;</dt>
<dd><p>Print <var>string</var> between each pair of fields written to output files.
This can be a comma, a tab character, your mother&rsquo;s maiden name, or the
full text of the GNU General Public License.  It is your choice.  Of course, 
it is most useful for it to be something that would not normally occur in
your data fields and something that your target system will understand.
Because <code>combine</code> doesn&rsquo;t care about such things, you can even use the
null character (<code>\0</code>) or the newline character (<code>\n</code>).
</p>
</dd>
<dt> &lsquo;<samp>--no-output-field-delimiter</samp>&rsquo;</dt>
<dd><p>This means that there is to be no delimiter between fields in the output file
or files.  It will prevent the input field delimiter from being taken as the 
output field delimiter.  In cases like this, it might behoove you either to 
ensure that the fields have a fixed length or to use Guile to insert your own 
delimiters before they are written.  When specified along with 
&lsquo;<samp>--output-field-delimiter</samp>&rsquo;, the option that appears later will override 
the prior one.
</p>
</dd>
<dt> &lsquo;<samp>-b <var>string</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--output-record-delimiter=<var>string</var></samp>&rsquo;</dt>
<dd><p>Similarly here <var>string</var> is whatever string you need to use to tell
the records apart in output files.  If you don&rsquo;t specify it, <code>combine</code>
will assume that the usual text format applies, the newline on GNU
operating systems.  (As of this writing, no port has been made to systems
where a newline is not the standard end-of-line character.)
</p>
</dd>
<dt> &lsquo;<samp>-D <var>string</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--input-field-delimiter=<var>string</var></samp>&rsquo;</dt>
<dd><p>Look for <var>string</var> in the associated input file to determine where
fields start and end.  It can be any string, but it should be the string
that really separates fields in your file.  Because <code>combine</code> doesn&rsquo;t
care about such things, you can even use the null character (<code>\0</code>)
or the newline character (<code>\n</code>).  At present, there is no interpretation
of quoted strings.  As a result, you may get unexpected results if the delimiter
shows up in the middle of one of your fields.
</p>
<p>When specified for the data file, the value specified is used as the input 
field delimiter for all reference files and as the output field delimiter for 
any output files, unless other action is taken.  The options 
&lsquo;<samp>--no-input-field-delimiter</samp>&rsquo; and &lsquo;<samp>--no-output-field-delimiter</samp>&rsquo; 
will tell <code>combine</code> that a given file should not have a delimiter.  The 
options &lsquo;<samp>--input-field-delimiter</samp>&rsquo; and &lsquo;<samp>--output-field-delimiter</samp>&rsquo; 
will use whatever delimiter you specify rather than the data file input field 
delimiter.
</p>
</dd>
<dt> &lsquo;<samp>--no-input-field-delimiter</samp>&rsquo;</dt>
<dd><p>This means that there is no delimiter between fields in the specified input file
or files.  It will prevent the data file input field delimiter from being taken 
as the input field delimiter for a reference file.  When specified along with 
&lsquo;<samp>--output-field-delimiter</samp>&rsquo;, the option that appears later will override 
the prior one.
</p>
</dd>
<dt> &lsquo;<samp>-B <var>string</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--input-record-delimiter=<var>string</var></samp>&rsquo;</dt>
<dd><p>Similarly here <var>string</var> is whatever string you need to use to tell
the records apart in input files.  If you don&rsquo;t specify it, <code>combine</code>
will assume that the usual text format applies, the newline on GNU
operating systems.
</p>
</dd>
<dt> &lsquo;<samp>-L <var>number</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--input-record-length=<var>number</var></samp>&rsquo;</dt>
<dd><p>If the records are all of the same length (whether of not there is a
linefeed or a &lsquo;<samp>W</samp>&rsquo; between them), you can specify a record length.
<code>combine</code> will then split the file into records all of exactly
<var>NUMBER</var> bytes long.  If there are linefeeds or carriage returns
between records, be sure to add them to the count.  If the length is not
specified, <code>combine</code> will assume the records have a delimiter between
them.
</p>
</dd>
<dt> &lsquo;<samp>-p</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--match-optional</samp>&rsquo;</dt>
<dd><p>Make it unnecessary to find a match to this file for inclusion in data
file based output and for the further processing of a data record.  All 
matches are required by default.  
</p>
<p>When applied to a reference file, this means that records based on a data 
record may be written without a match to a key in this reference file, 
and any output from fields in this file will be left blank (or substituted 
if specified with the &lsquo;<samp>-O</samp>&rsquo; option).  
</p>
<p>When applied to a data file, this means that in the file based on the data
file records, records will be written at the end of processing for reference
file records that were not matched by a data file record.  Any output 
specified from fields in the data file will be left blank (or substituted
if specified with the &lsquo;<samp>-O</samp>&rsquo; option).  If there is more than one reference
file, care should be taken, because the unmatched records from each reference
file will each become a record in the output file.  This has no effect on 
reference-file-based output.
</p>
</dd>
<dt> &lsquo;<samp>-P</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--exclude-match</samp>&rsquo;</dt>
<dd><p>Require no match to this file for inclusion in data file based output and 
for the further processing of a data record.  All matches are required and
included by default.  This differs from &lsquo;<samp>--match-optional</samp>&rsquo; in that 
records that do have a match are excluded from further consideration.
</p>
<p>When applied to a reference file, this means that records based on a data 
record may only be written when there is no match to a key in this reference 
file, and any output from fields in this file will be left blank (or 
substituted if specified with the &lsquo;<samp>-O</samp>&rsquo; option).  
</p>
<p>When applied to a data file, this means that in the file based on the data
file records, records will only be written at the end of processing for 
reference file records that were not matched by a data file record.  Any output 
specified from fields in the data file will be left blank (or substituted
if specified with the &lsquo;<samp>-O</samp>&rsquo; option).  If there is more than one reference
file, care should be taken, because the unmatched records from each reference
file will each become a record in the output file.  This has no effect on 
reference-file-based output.
</p>
</dd>
</dl>

<hr size="6">
<a name="Data-Files"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#File-Options" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Reference-Files" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#How-combine-Processes-Files" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Data-Files-1"></a>
<h2 class="section">2.3 Data Files</h2>
<a name="index-data-file"></a>
<a name="index-file_002c-data"></a>
<a name="index-options_002c-data-file"></a>

<p>A data file is either <code>stdin</code>, one or more files, or both.  If
there is more than one source, they should all share a format that fits
the specifications provided for output fields, fields holding numeric
values to be summed, and fields to be used as keys for matching.
</p>
<p>The following are the commands that specifically affect the processing
of the data file.  Some share the same name with options that can also
apply to reference files.  Those must be on your command line before you
present your first reference file.  The others could appear anywhere on
the command line; however, convention dictates that all the data-file
options should be together before the first reference file is named.
</p>
<dl compact="compact">
<dt> &lsquo;<samp>-w</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--write-output</samp>&rsquo;</dt>
<dd><p>Signals the program that output records should be written every time a
data record satisfies the matching criteria with the reference files.
The record written will combine all specified output fields from the
data file record, the matching reference file record(s), and any specified
constant values.  This option is a positional option for all files, and
must appear before the first reference file is named.
</p>
</dd>
<dt> &lsquo;<samp>-t <var>filename</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--output-file=<var>filename</var></samp>&rsquo;</dt>
<dd><p>If provided, write the data-based output to <var>filename</var>.  Otherwise
the output will go to <code>stdout</code>.  This option only makes sense if
you plan to write data-file-based output.  This is a positional option
for all files and must appear before the first reference file is named.
</p>
</dd>
<dt> &lsquo;<samp>-o <var>range_string</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--output-fields=<var>range_string</var></samp>&rsquo;</dt>
<dd><p>Write the fields specified by <var>range_string</var> as part of the record
in any data-based output.  The range specifications share a common
format with all field specifications for <code>combine</code>.  This option only
makes sense if you plan to write data-file-based output.  This is a
positional option and to apply to the data file it must appear before
the first reference file is named.
</p>
</dd>
<dt> &lsquo;<samp>-K <var>string</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--output-constant=<var>string</var></samp>&rsquo;</dt>
<dd><p>Write <var>string</var> to the data-file-based output.  This option only
makes sense if you plan to write data-file-based output.  This is a
positional option and to apply to the data file it must appear before
the first reference file is named.
</p>
</dd>
<dt> &lsquo;<samp>-s <var>range_string</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--sum-fields=<var>range_string</var></samp>&rsquo;</dt>
<dd><p>In any reference-file-based output write a sum of the value of the
fields specified by <var>range_string</var>.  The sum for a given reference
file record will come from all data file records that matched it.  This
option only makes sense if you have requested reference-file-based
output.
</p>
<p>If a precision is provided for a sum field, that precision is honored, 
and decimal fractions up to that many digits will be included in the sum.
Any further precision on the input fields will be ignored (without 
rounding) in the sum.  The resulting sum will be written with a decimal
point and the number of fractional digits implied by the precision.
</p>
</dd>
</dl>

<hr size="6">
<a name="Reference-Files"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Data-Files" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Output-Files" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#How-combine-Processes-Files" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Reference-Files-1"></a>
<h2 class="section">2.4 Reference Files</h2>
<a name="index-reference-file"></a>
<a name="index-file_002c-reference"></a>
<a name="index-options_002c-reference-file"></a>

<p>A reference file record is expected to match on a set of key fields to a
data file record.  The parts of a reference file that are necessary for
processing are read entirely into memory.  You can specify as many
reference files as you want, depending only on the amount of memory your
system can spare to hold them.  For any reference file, it is minimally
required that you specify a file name, a specification of the key fields
in the reference file, and a specification of the matching key fields in
the data file.
</p>
<p>The following are the options that are related to reference files.  They
are all positional, and they apply to the processing of the previously
named reference file.  (Except of course for the reference file name
itself, which applies to itself.)
</p>
<dl compact="compact">
<dt> &lsquo;<samp>-r <var>filename</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--reference-file=<var>filename</var></samp>&rsquo;</dt>
<dd><p>Use <var>filename</var> as a reference file to match to the data file in
processing.  This option introduces a block of positional options that
relate to this reference file&rsquo;s processing in <code>combine</code>.
</p>
</dd>
<dt> &lsquo;<samp>-k <var>range_string</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--key-fields=<var>range_string</var></samp>&rsquo;</dt>
<dd><p>Use the fields specified by <var>range_string</var> as a key to match to a
corresponding key in the data file.
</p>
</dd>
<dt> &lsquo;<samp>-m <var>range_string</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--data-key-fields=<var>range_string</var></samp>&rsquo;</dt>
<dd><p>Use the fields specified by <var>range_string</var> as the corresponding key
to a key taken from a reference file.
</p>
</dd>
<dt> &lsquo;<samp>-a <var>range_string</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--hierarchy-key-fields=<var>range_string</var></samp>&rsquo;</dt>
<dd><p>Use the fields specified by <var>range_string</var> as a key to perform a
recursive hierarchical match within the reference file.  This key will
be matched against values specified in the regular key on the reference
file.
</p>
</dd>
<dt> &lsquo;<samp>-u</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--unique</samp>&rsquo;</dt>
<dd><p>Keep only one record for the reference file in memory for each distinct
key.  By default <code>combine</code> maintains all the records from the
reference file in memory for processing.  This default allows for
cartesian products when a key exists multiple times in both the
reference and data files.
</p>
</dd>
<dt> &lsquo;<samp>-h <var>number</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--hash-size=<var>number</var></samp>&rsquo;</dt>
<dd><p>Use the <var>number</var> provided as a base size for allocating a hash table
to store the records from this reference file.  If this number is too
small, <code>combine</code> will fail when it tries to record a record it has no
room for.  If it is only a little bit too small, it will cause
inefficiency as searching for open space in the hash table will be
difficult.
</p>
</dd>
<dt> &lsquo;<samp>-H <var>keyword</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--hash-movement=<var>keyword</var></samp>&rsquo;</dt>
<dd><p>One of the keywords <code>binary</code>, <code>number</code>, <code>beginning</code>, 
or <code>end</code>, indicating how to turn the key into a number with 
the best variability and least overlap.  The wise choice of this option 
can cut processing time significantly.  The binary option is the default, 
and treats the last few bytes (8 on most computers) of the key string(s) 
as a big number.  The number option converts the entire key to a number
assuming it is a numeric string.  The other two take the least significant 
3 bits from each of the first or last few (21 where a 64 bit integer is
available) bytes in the key strings and turns them into a number.
</p>
</dd>
<dt> &lsquo;<samp>-w</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--write-output</samp>&rsquo;</dt>
<dd><p>Signals the program that output records should be written for every
record stored for this reference file.  This will either be one record
for every record in the reference file or one record for every distinct
set of keys in the reference file, depending on the setting of the
option &lsquo;<samp>--unique</samp>&rsquo;.  The record written will include all specified
output fields from the reference file record, any specified constant
value for this reference file, and any flag, counter, or sums requested.
</p>
</dd>
<dt> &lsquo;<samp>-t <var>filename</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--output-file=<var>filename</var></samp>&rsquo;</dt>
<dd><p>If provided, write the output based on this reference file to
<var>filename</var>.  Otherwise the output will go to <code>stdout</code>.  This
option only makes sense if you plan to write output based on this
reference file.
</p>
</dd>
<dt> &lsquo;<samp>-o <var>range_string</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--output-fields=<var>range_string</var></samp>&rsquo;</dt>
<dd><p>Write the fields specified by <var>range_string</var> as part of the record
in any reference-file- or data-file-based output.  The range
specifications share a common format with all field specifications for
<code>combine</code>.
</p>
</dd>
<dt> &lsquo;<samp>-K <var>string</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--output-constant=<var>string</var></samp>&rsquo;</dt>
<dd><p>Write <var>string</var> to the reference- or data-file-based output.
</p>
</dd>
<dt> &lsquo;<samp>-U</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--up-hierarchy</samp>&rsquo;</dt>
<dd><p>When traversing the hierarchy from a given reference-file record, use
the values on that record in the &lsquo;<samp>--hierarchy-key-fields</samp>&rsquo; fields
to connect to the &lsquo;<samp>--key-fields</samp>&rsquo; fields of other records from the
reference file.  For most purposes, the presence of the connection on the 
first record suggests a single parent in a standard hierarchy.  The hierarchy
traversal stops when the &lsquo;<samp>--hierarchy-key-fields</samp>&rsquo; fields are empty.
</p>
<p>If this option is not set, the &lsquo;<samp>--key-fields</samp>&rsquo; fields are used to search 
for the same values in the &lsquo;<samp>--hierarchy-key-fields</samp>&rsquo; fields of other
records in the same file.  This allows multiple children of an initial record, 
and suggests going down in the hierarchy.  The hierarchy traversal stops when 
no further connection can be made.  The traversal is depth-first.
</p>
</dd>
<dt> &lsquo;<samp>-l</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--hierarchy-leaf-only</samp>&rsquo;</dt>
<dd><p>When traversing a hierarchy, treat only the endpoints as matching records.
Nodes that have onward connections are ignored except for navigating to the
leaf nodes.
</p>
</dd>
<dt> &lsquo;<samp>-F <var>number</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--flatten-hierarchy=<var>number</var></samp>&rsquo;</dt>
<dd><p>When traversing a hierarchy, act as the &lsquo;<samp>hierarchy-leaf-only</samp>&rsquo;, except
save information about the intervening nodes.  Repeat the &lsquo;<samp>output-fields</samp>&rsquo;
fields <var>number</var> times (leaving them blank if there were fewer levels), 
starting from the first reference record matched.
</p></dd>
</dl>

<hr size="6">
<a name="Output-Files"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Reference-Files" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Field-Specifiers" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#How-combine-Processes-Files" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Output-Files-1"></a>
<h2 class="section">2.5 Output Files</h2>

<p>There are two basic kinds of output files: one based on the data records
and reference records that match them, the other based on a full set of
records from one reference file with flags, counts, or sums based on the 
aggregate of the matching data records.
</p>
<p>The output file based on the data file consists of information from the
data file records and any matching reference file records.  The records
that go into data-based output files can be figured out as follows:
</p>
<dl compact="compact">
<dt> no reference file</dt>
<dd><p>If there is no reference file, there will be one record for every record
in the data file, with the exception of any records that were elimitated
through an extension filter. (see section <a href="#Extending-combine">Extending <code>combine</code></a>.) 
</p>
</dd>
<dt> reference files with &lsquo;<samp>--unique</samp>&rsquo; and &lsquo;<samp>--match-optional</samp>&rsquo; options</dt>
<dd><p>If all reference files are specified with the &lsquo;<samp>--unique</samp>&rsquo; and
&lsquo;<samp>--match-optional</samp>&rsquo; options, then the records selected for insertion
into the data-based output file will be the same as those that would be
selected without a reference file.
</p>
</dd>
<dt> reference files without the &lsquo;<samp>--unique</samp>&rsquo; option</dt>
<dd><p>If a reference file is not given the &lsquo;<samp>--unique</samp>&rsquo; option and there
is more than one reference record that matches a given data record, then
the data record will be represented more than once in the output file,
each time combined with information from a different matching reference
record.  If there is more than one reference file where this is the
case, the result will be multiplicative (e.g. 2 matches in each of 2
reference files will produce 4 records).  This is the default setting
for a reference file.
</p>
</dd>
<dt> reference files without the &lsquo;<samp>--match-optional</samp>&rsquo; option</dt>
<dd><p>If a reference file is not given the &lsquo;<samp>--match-optional</samp>&rsquo; option, then
any data record that does not have a match in the reference file will
not be represented in the output file.  This is the default setting.
</p></dd>
</dl>

<p>The fields that can appear in data=file-based output can come from the
data-file record and any matching reference file records.
</p>
<p>Reference=file-based output files are simpler.  Depending on the
existence or not of the &lsquo;<samp>--unique</samp>&rsquo; option, the file will have an
entry for each of the unique keys or for each of the records in the
reference file, respectively.
</p>
<p>The fields in the reference=file-based output are exclusively from the
reference file, except for optional fields that can be summarized from
fields on matching data-file records.
</p>

<p>The order of the fields in an output record can either be according to
the default or it can be explicitly specified by the user.
</p>
<p>In data=file-based output, the standard field order is as follows.  All the
fields listed are printed in this order if they are specified.  If an
output field delimiter is specified, it is put between every pair of
adjacent fields.  If there is no match for a given reference file (and
the &lsquo;<samp>--match-optional</samp>&rsquo; option is set for the file), all the fields that
would normally be provided by that file are filled with spaces for
fixed-width fields or zero-length for delimited output.
</p>
<ul>
<li> All the data-file output fields (in order)
</li><li> The constant string set for the data file
</li><li> For each reference file

  <ul class="toc">
<li>- The constant string set for the reference file
  </li><li>- All the reference-file output fields
  </li></ul>

</li></ul>

<p>In reference=file-based output, the standard field order is as follows.
All the fields listed are printed in this order if they are specified.
If an output field delimiter is specified, it is put between every pair
of adjacent fields.
</p>
<ul>
<li> All the reference-file output fields OR the key fields if no output fields are given
</li><li> A 1/0 flag indicating whether there was any match
</li><li> A counter of the number of data records matched
</li><li> A sum of each of the data-file sum fields from each matching data-file record
</li></ul>

<p>The order of the fields in any output file can be customized using the
&lsquo;<samp>--field-order</samp>&rsquo; (or &lsquo;<samp>-O</samp>&rsquo;) option.  The argument for the
option is a comma-separated list of field identifiers.  Each field
identifier has 2 parts, a source and a type, separated by a period (.).
</p>
<p>The sources are composed of an &lsquo;<samp>r</samp>&rsquo; for reference file or &lsquo;<samp>d</samp>&rsquo;
for data file followed by an optional number.  The number indicates
which reference file the field comes from and is ignored for data files.
Without a number, the first of each is taken.
</p>
<p>A third source &lsquo;<samp>s</samp>&rsquo; represents a substitution in the event that the
preceding reference file field could not be provided because there was
no match between that reference file and the data file.  The number
following it, if blank or zero, tells <code>combine</code> to take the field from
the data file.  Any other number means the corresponding reference file.
This allows the conditional update of fields from the data file, or a
prioritization of selections from a variety of reference files.  If you
are working with fixed-width fields, you should ensure that the lengths
of the various fields in the substitution chain are the same.
</p>
<p>The types are composed similarly.  The identifiers are listed below.
The number is ignored for identifiers of string constants, flags, and
counters.  For output fields, a hyphen-separated range of fields can be
written to avoid having to write a long list.  Any number provided is
the number of the field in the order it was specified in the &lsquo;<samp>-o</samp>&rsquo;
or &lsquo;<samp>-s</samp>&rsquo; option on the command line.  In delimited-field files
this may differ from the field number used in those options.
</p>
<dl compact="compact">
<dt> &lsquo;<samp>o</samp>&rsquo;</dt>
<dd><p>Output fields from either reference or data files.
</p>
</dd>
<dt> &lsquo;<samp>k</samp>&rsquo;</dt>
<dd><p>String constant for either reference or data files.
</p>
</dd>
<dt> &lsquo;<samp>f</samp>&rsquo;</dt>
<dd><p>Flag (1/0) for reference files.
</p>
</dd>
<dt> &lsquo;<samp>n</samp>&rsquo;</dt>
<dd><p>Counter for reference files.
</p>
</dd>
<dt> &lsquo;<samp>s</samp>&rsquo;</dt>
<dd><p>Sum field for reference files.
</p>
</dd>
</dl>

<p>Here is an example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">--field-order d.o1,d.o2,d.o3,d.k,r1.o1,s2.o1,s0.o4

--field-order d.o1-3,d.k,r1.o1,s2.o1,s0.o4
</pre></td></tr></table>

<p>In this case, the first three fields from the data file are followed by
the constant string from the data file.  Then, if there was a match to
reference file 1, the first field from that file is taken, otherwise if
there was a match to reference file 2, the first field from that file is
taken.  If neither file matched the data record, the fourth field from
the data record is taken instead.
</p>
<p>The second line is equivalent, using a range of fields for convenience.
</p>
<hr size="6">
<a name="Field-Specifiers"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Output-Files" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Emulation" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#How-combine-Processes-Files" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Field-Specifiers-1"></a>
<h2 class="section">2.6 Field Specifiers</h2>

<p>There are a number of options that require a list of fields from one of
the files.  All take an argument consisting of a comma-separated list of
individual field specifications.
</p>
<p>The individual field specifications are of the form
&lsquo;<samp>s-e.p(instruction)</samp>&rsquo;.  As a standard (with no field delimiter
given for the file), &lsquo;<samp>s</samp>&rsquo; is a number indicating the starting
position of the field within the records in th given file, and &lsquo;<samp>e</samp>&rsquo; 
is a number pointing out the ending position.  If there is no hyphen, the
single number &lsquo;<samp>s</samp>&rsquo; represents a one-byte field at position &lsquo;<samp>s</samp>&rsquo;.
If the first number and a hyphen exist without the number &lsquo;<samp>e</samp>&rsquo;, then
the field is assumed to start at &lsquo;<samp>s</samp>&rsquo; and extend to the end of the
record.  The numbering of the bytes in the record starts at 1.
</p>
<p>If you do provide a delimiter for identifying the borders between fields
in your file, then <code>combine</code> does not need to count bytes, and you
just need to provide the field number (starting at 1) of the fields you
want to declare.  Currently, giving a range of fields results in
<code>combine</code> acting as though you listed every field from the lower end
to the upper end of the range individually.  Any precision or
extensibility information you provide will be applied to each field in
the range.
</p>
<p>The optional &lsquo;<samp>.p</samp>&rsquo; gives the number of digits of precision with
which the field should be considered.  At present its only practical use
is in fields to be summed from data files, where it is used in converting
between string and number formats.
</p>
<p>The optional &lsquo;<samp>(instruction)</samp>&rsquo; is intended for extensibility.  For
output fields and key fields it is a scheme command that should be run
when the field is read into the system.  If the associated field
specification is a key for matching reference and data records, this can
affect the way the records are matched.  If it is a field to be written
to an output file, it will affect what the user sees.
</p>
<p>To refer to the field actually read from the source data within the
scheme command, use the following sceme variable in the appropriate place 
in the command: &lsquo;<samp>input-field</samp>&rsquo;
</p>
<p>Scheme commands attached to individual fields need to return a character
string and have available only the current text of the field as
described above<a name="DOCF1" href="#FOOT1">(1)</a>.  In delimited
output, feel free to alter the length of the return string at will.  In
fixed-width output, it will be your responsibility to ensure that you
return a string of a useful length if you want to maintain the fixed
structure.
</p>

<p>In the following string,
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">1-10,15-20.2,30(HiMom input-field),40-
</pre></td></tr></table>

<p>The fist field runs from position 1 to 10 in the record.  The second from
15 to 20, with a stated (but possibly meaningless) precision of 2.  The 
third is the single byte at position 30, to be adjusted by replacing it 
with whatever the scheme function <code>HiMom</code> does to it.  The fourth 
field starts at position 40 and extends to the end of the record.
</p>
<p>In a delimited example, the following two sets of options are equivalent.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">-D ',' -o 4,5,6,7,8
-D ',' -o 4-8
</pre></td></tr></table>

<p>In both cases the fourth, fifth, sixth, seventh, and eighth
comma-delimited fields are each treated as an individual field for
processing.  Note that if you also provide a field order (with the
&lsquo;<samp>-O</samp>&rsquo; option), that order would refer to these fields as 1, 2, 3,
4, and 5 because of the order in which you specified them, not caring
about the order in the original file.
</p>

<hr size="6">
<a name="Emulation"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Field-Specifiers" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#How-combine-Processes-Files" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#How-combine-Processes-Files" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Emulation-1"></a>
<h2 class="section">2.7 Emulation</h2>

<p>Because of its simularity with <code>join</code>, <code>combine</code> has an emulation
mode that allows you to use the syntax of the <code>join</code> command to start
<code>combine</code>.
</p>
<p>The emulation can be started by using &lsquo;<samp>--emulate join</samp>&rsquo; option as the
first option after the command name.  After that, you can use the same 
options you get with join.
</p>
<p>For details of the <code>join</code> command, see See <a href="coreutils.html#join-invocation">(coreutils.info)join invocation</a> section &lsquo;Join Invocation&rsquo; in <cite>GNU Coreutils Manual</cite>.
When tested against the test cases packaged with GNU Coreutils, results are
identical to join with a couple of exceptions:
</p>
<ul>
<li>
The sort order can be different.  <code>combine</code> produces records in the order
of the second input file, with any unmatched records from the first input file
following in an arbitrary order.

</li><li>
I change the arguments to the &lsquo;<samp>-o</samp>&rsquo; option in the test script to have
quotes around the field order list when it is separated by spaces.  <code>combine</code>
can handle the space-delimited list, but the standard argument handler 
<code>getopt_long</code> does not interpret them as a single argument.  I don&rsquo;t see the
need to overcome that.

</li><li>
There is not a specific test, but I have not yet implemented case-insensitive 
matching.  It would have failed if tested. 

</li><li>
One more option that is not implemented in the emulation are the &lsquo;<samp>-j1</samp>&rsquo;
and &lsquo;<samp>-j2</samp>&rsquo; methods of specifying separate keys for the two files.  Use 
&lsquo;<samp>-1</samp>&rsquo; and &lsquo;<samp>-2</samp>&rsquo; for that.  The two obsolete options would be interpreted
as speciying field 1 or field 2 as the common join key, respectively. 

</li></ul>

<p>There are also a number of features of <code>combine</code> that come through in the
emulation.  The main features relate to the keys: the sort order of the records
in relation to the keys does not matter to <code>combine</code>.  <code>combine</code> also
allows you to specify a list of key fields (comma-delimited) rather than just
one as arguments to &lsquo;<samp>-1</samp>&rsquo;, &lsquo;<samp>-2</samp>&rsquo;, and &lsquo;<samp>-j</samp>&rsquo;.  You should make
sure that the number of key fields is the same.
</p>
<p>Another feature is that the second input file can actually be as many files as 
you want.  That way you can avoid putting the records from several files together
if not otherwise necessary.
</p>
<hr size="6">
<a name="How-combine-Processes-Files"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Emulation" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Extending-combine" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Invoking-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Extending-combine" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="How-combine-Processes-Files-1"></a>
<h1 class="chapter">3. How <code>combine</code> Processes Files</h1>

<p>The base of <code>combine</code> reads records from a data file (or a series of
them in a row) and if there is an output request for data records, it
writes the requested fields out to a file or to <code>stdout</code>.  Here is
an example of this most simple version of events.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">combine --write-output --output-fields=1-
</pre></td></tr></table>

<p>This is essentially an expensive pipe.  It reads from <code>stdin</code> and
writes the entire record back to <code>stdout</code>.
</p>
<p>Introducing a reference file gives more options.  Now <code>combine</code> reads
the reference file into memory before reading the data file.  For every
data record, <code>combine</code> then checks to see if it has a match.  The
following example limits the simple pipe above by restricting the output
to those records from <code>stdin</code> that share the first 10 bytes in
common with a record in the reference file.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">combine -w -o 1- -r reference_file.txt --key-fields=1-10 \
            --data-key-fields=1-10 --unique
</pre></td></tr></table>

<p>Note that the option &lsquo;<samp>--unique</samp>&rsquo; is used here to prevent more than
one copy of a key from being stored by <code>combine</code>.  Without it, 
duplicate keys in the reference file, when matched, would result in
more than one copy of the matching data record.
</p>
<p>The other option with a reference file is to have output based on the
records in that file, with indicators of how the data file records were
able to match to them.  In the next example, the same match as above is
done, but this time we write out a record for every unique key, with a
flag set to &lsquo;<samp>1</samp>&rsquo; if it was matched by a data record or &lsquo;<samp>0</samp>&rsquo;
otherwise.  It still reads the data records from <code>stdin</code> and writes
the output records to <code>stdout</code>.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">combine -r -f reference_file.txt -k 1-10 -m 1-10 -u -w -o 1-10
</pre></td></tr></table>

<p>Of course, you might want both sets of output at the same time: the list
of data records that matched the keys in the reference file and a list
of keys in the reference file with an indication of which ones were
matched.  In the prior two examples the two different kinds of output
were written to <code>stdout</code>.  You can still do that if you like, and
then do a little post-processing to determine where the data-based
records leave off and the reference-based records begins.  A simpler
way, however, is to let <code>combine</code> write the information to separate
files.
</p>
<p>In the following example we combine the output specifications from the
prior two examples and give them each a filename.  Note that the first
one has a spelled-out &lsquo;<samp>--output-file</samp>&rsquo; while the second one uses the
shorter 1-letter option &lsquo;<samp>-t</samp>&rsquo;.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">combine -w -o 1- --output-file testdata.txt \
            -r -f reference_file.txt -k 1-10 -m 1-10 \
            -u -w -o 1-10 -t testflag.txt
</pre></td></tr></table>



<hr size="6">
<a name="Extending-combine"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#How-combine-Processes-Files" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Extension-Options" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#How-combine-Processes-Files" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Extending-combine-1"></a>
<h1 class="chapter">4. Extending <code>combine</code></h1>

<p>If <code>combine</code> was built with Guile (GNU&rsquo;s Ubiquitous Intelligent
Language for Extensibility), you can do anything you want (within reason) to
extend <code>combine</code>.  This would have been set up when <code>combine</code> was 
compiled and installed on your computer.  In a number of places, there 
are built-in opportunities to call Guile with the data that is currently in 
process.  Using these options, you can use your favorite modules or write your 
own functions in scheme to manipulate the data and to adjust how <code>combine</code>
operates on it.
</p>
<p>The most common method (in my current usage) of extending <code>combine</code> is
to alter the values of fields from the input files before they are used
for matching or for output.  This is done inside the field list by
adding the scheme statement after the range and precision.  This is
covered in the section on field specifications. See section <a href="#Field-Specifiers">Field-specific extensions</a>, for details.
</p>
<p>Another useful option is the ability to initialize Guile with your own
program.  To do this, you can use the &lsquo;<samp>--extension-init-file</samp>&rsquo; (or
&lsquo;<samp>-X</samp>&rsquo;) followed by a file name.  <code>combine</code> will load that
scheme file into Guile before any processing.  In that way your
functions will be available when you need them in the running of the
program.  It certainly beats writing something complicated on the
command line.
</p>
<p>In addition, there are Guile modules included in the distribution, which
can be used in extension scripts.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Extension-Options">4.1 Extension Options</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Guile-Modules">4.2 Guile Modules</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Extension-Options"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Extending-combine" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Guile-Modules" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Extending-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Extending-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Extension-Options-1"></a>
<h2 class="section">4.1 Extension Options</h2>
<a name="index-extension-options"></a>
<a name="index-options_002c-extension"></a>
<p>The remaining extensibility options are called at various points in the
program: when it starts, when a file is started, when a match is found,
when a record is read, when a record is written, when a file is closed,
and at the very end of the program.  The options are listed below along
with the way to get access to the relevant data.
</p>
<p>The various non-field=specific options are as follows.  They all occur
as arguments to the option &lsquo;<samp>--extension</samp>&rsquo; (or &lsquo;<samp>-x</samp>&rsquo;).
</p>
<dl compact="compact">
<dt> &lsquo;<samp>l<var>scheme-command</var></samp>&rsquo;</dt>
<dd><p>Filter records from the current file using the scheme command provided.
The scheme command must return &lsquo;<samp>#t</samp>&rsquo; (to keep processing the record)
or &lsquo;<samp>#f</samp>&rsquo; (to ignore this record and move on to the next).  The
variables &lsquo;<samp>reference-field-n</samp>&rsquo; or &lsquo;<samp>data-field-n</samp>&rsquo; will be
available to the scheme command, depending on whether the record to be
filtered is from the data file or a reference file.  In the variable
names &lsquo;<samp>n</samp>&rsquo; represents the number of the specified output field,
numbered from 1.
</p>
</dd>
<dt> &lsquo;<samp>m<var>scheme-command</var></samp>&rsquo;</dt>
<dd><p>Validate a proposed match using the scheme command provided.  The scheme
command must return &lsquo;<samp>#t</samp>&rsquo; (to confirm that this is a good match) or
&lsquo;<samp>#f</samp>&rsquo; (to tell <code>combine</code> that this is not a match).  The variables
&lsquo;<samp>reference-field-n</samp>&rsquo; and &lsquo;<samp>data-field-n</samp>&rsquo; will be available to the
scheme command from the reference and data records involved in a
particular match.  In the variable names &lsquo;<samp>n</samp>&rsquo; represents the number
of the specified output field, numbered from 1.  The extension
specification affects the match between the data file and the last named
reference file.
</p>
</dd>
<dt> &lsquo;<samp>h<var>scheme-command</var></samp>&rsquo;</dt>
<dd><p>Validate a proposed match between two records in the same hierarchy using 
the scheme command provided.  The scheme command must return &lsquo;<samp>#t</samp>&rsquo; 
(to confirm that this is a good match) or &lsquo;<samp>#f</samp>&rsquo; (to tell <code>combine</code> 
that this is not a match).  The variables &lsquo;<samp>reference-field-n</samp>&rsquo; and 
&lsquo;<samp>prior-reference-field-n</samp>&rsquo; will be available to the scheme command 
from the prior and current reference records involved in a particular 
match.  In the variable names &lsquo;<samp>n</samp>&rsquo; represents the number of the 
specified output field, numbered from 1.  The extension specification 
affects the match while traversing the hierarchs in the last named 
reference file.
</p>
</dd>
<dt> &lsquo;<samp>r<var>scheme-command</var></samp>&rsquo;</dt>
<dd><p>Modify a record that has just been read using the scheme command
provided.  The scheme command must return a string, which will become
the new value of the input record to be processed.  The input record
iteself can be referred to in the scheme command by using the variable
&lsquo;<samp>input-record</samp>&rsquo; in the scheme command at the right place.  The 
records affected by this option are the records from the most recently 
named reference file, or from the data file if no reference file has 
yet been named.
</p></dd>
</dl>

<p>As an example, consider that you may have received a file from someone
who strips all the trailing spaces from the end of a record, but you
need to treat it with a fixed-width record layout.  Assuming that you
have defined a scheme function <code>rpad</code> in the initialization file
&lsquo;<samp>util.scm</samp>&rsquo;, you can use the following command to get at the field
in positions 200-219, with spaces in place of the missing rest of the
record.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">combine -X util.scm -x 'r(rpad input-record 219 #\space)' \
            -o 200-219 trimmed_file.txt
</pre></td></tr></table>

<p>The same syntax works with the other &lsquo;<samp>--extension</samp>&rsquo; options.
</p>
<hr size="6">
<a name="Guile-Modules"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Extension-Options" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Calendar-Functions" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Extending-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Extending-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Guile-Modules-1"></a>
<h2 class="section">4.2 Guile Modules</h2>
<a name="index-guile-modules"></a>
<a name="index-modules_002c-guile"></a>

<p>Here we talk about Guile modules that are distributed with <code>combine</code>.
At the moment, those are limited to date processing.
</p>
<p>In addition, the file &lsquo;<samp>util.scm</samp>&rsquo; in the distribution contains a few
functions I have found handy.  They are not documented here, and the file 
doesn&rsquo;t get installed automatically.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Calendar-Functions">4.2.1 Calendar Functions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Calendar-Reference">4.2.2 Calendar Reference</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Calendar-Parsing">4.2.3 Calendar Parsing</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Calendar-Functions"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Guile-Modules" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Calendar-Reference" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Extending-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Guile-Modules" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Calendar-Functions-1"></a>
<h3 class="subsection">4.2.1 Calendar Functions</h3>
<a name="index-calendar-functions"></a>
<a name="index-extensions_002c-calendar"></a>
<a name="index-modules_002c-calendar"></a>

<p>Included in the <code>combine</code> package are two Guile modules to work with dates
from a number of calendars, both obscure and common.  The basis for them is
the set of calendar functions that are shipped with Emacs.
</p>
<p>The reason that these functions deserve special notice here is that date
comparisons are a common type of comparison that often cannot be made 
directly on a character string.  For example I might have trouble knowing
if &quot;20030922&quot; is the same date as &quot;22 September 2003&quot; if I compared strings;
however, comparing them as dates allows me to find a match.  We can even 
compare between calendars, ensuring that &quot;1 Tishri 5764&quot; is recognized as the
same date as &quot;20030927&quot;.
</p>
<p>The calendar module can be invoked as <code>(use-modules (combine_scm calendar))</code>.  
It provides functions for converting from a variety of calendars to and from
and absolute date count, whose 0-day is the imaginary date 31 December 1 B.C.
In the functions, the absolute date is treated as a single number, and the
dates are lists of numbers in <code>(month day year)</code> format unless otherwise 
specified.
</p>
<p>The calendar functions are as follow:
</p>
<ul>
<li> calendar-absolute-from-julian
</li><li> calendar-julian-from-absolute
</li><li> calendar-absolute-from-islamic
</li><li> calendar-islamic-from-absolute
</li><li> calendar-absolute-from-hebrew
</li><li> calendar-hebrew-from-absolute
</li><li> calendar-absolute-from-chinese &lsquo;<samp>(cycle year month day)</samp>&rsquo;
</li><li> calendar-chinese-from-absolute &lsquo;<samp>(cycle year month day)</samp>&rsquo;
</li><li> calendar-absolute-from-french
</li><li> calendar-french-from-absolute
</li><li> calendar-absolute-from-coptic
</li><li> calendar-coptic-from-absolute
</li><li> calendar-absolute-from-ethiopic
</li><li> calendar-ethiopic-from-absolute
</li><li> calendar-absolute-from-iso &lsquo;<samp>(week day year)</samp>&rsquo;
</li><li> calendar-iso-from-absolute &lsquo;<samp>(week day year)</samp>&rsquo;
</li><li> calendar-absolute-from-persian
</li><li> calendar-persian-from-absolute
</li><li> calendar-mayan-long-count-from-absolute &lsquo;<samp>(baktun katun tun uinal kin)</samp>&rsquo;
</li><li> calendar-mayan-haab-from-absolute &lsquo;<samp>(day . month)</samp>&rsquo;
</li><li> calendar-mayan-tzolkin-from-absolute &lsquo;<samp>(day . name)</samp>&rsquo;
</li><li> calendar-absolute-from-445fiscal &lsquo;<samp>(month workday year)</samp>&rsquo;
</li><li> calendar-445fiscal-from-absolute &lsquo;<samp>(month workday year)</samp>&rsquo;
</li></ul>

<hr size="6">
<a name="Calendar-Reference"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Calendar-Functions" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Calendar-Parsing" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Extending-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Guile-Modules" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Calendar-Reference-1"></a>
<h3 class="subsection">4.2.2 Calendar Reference</h3>
<a name="index-calendar-reference"></a>
<a name="index-reference-strings_002c-calendar"></a>

<p>Here are some variables that can be used as references to get names
associated with the numbers that the date conversion functions produce
for months.
</p>
<dl compact="compact">
<dt> &lsquo;<samp>gregorian-day-name-alist</samp>&rsquo;</dt>
<dd><p>An associative list giving the weekdays in the Gregorian calendar
in a variety of languages.  Each element of this list is a list
composed of a 2-letter language code (lowercase) and a list of 7
day names.
</p></dd>
<dt> &lsquo;<samp>gregorian-month-name-alist</samp>&rsquo;</dt>
<dd><p>An associative list giving the months in the Gregorian calendar
in a variety of languages.  Each element of this list is a list
composed of a 2-letter language code (lowercase) and a list of 12
month names.
</p></dd>
<dt> &lsquo;<samp>calendar-islamic-month-name-array</samp>&rsquo;</dt>
<dd><p>A list of the months in the Islamic calendar.
</p></dd>
<dt> &lsquo;<samp>calendar-hebrew-month-name-array-common-year</samp>&rsquo;</dt>
<dd><p>A list of the months in the standard Hebrew calendar.
</p></dd>
<dt> &lsquo;<samp>calendar-hebrew-month-name-array-leap-year</samp>&rsquo;  </dt>
<dd><p>A list of the months in the leap year Hebrew calendar.
</p></dd>
<dt> &lsquo;<samp>chinese-calendar-celestial-stem</samp>&rsquo;</dt>
<dt> &lsquo;<samp>chinese-calendar-terrestrial-branch</samp>&rsquo;</dt>
<dt> &lsquo;<samp>lunar-phase-name-alist</samp>&rsquo;</dt>
<dt> &lsquo;<samp>solar-n-hemi-seasons-alist</samp>&rsquo;</dt>
<dt> &lsquo;<samp>solar-s-hemi-seasons-alist</samp>&rsquo;</dt>
<dt> &lsquo;<samp>french-calendar-month-name-array</samp>&rsquo;</dt>
<dd><p>A list of the months in the French Revolutionary calendar.
</p></dd>
<dt> &lsquo;<samp>french-calendar-multibyte-month-name-array</samp>&rsquo;</dt>
<dd><p>A list of the months in the French Revolutionary calendar, using
multibyte codes to represent the accented characters.
</p></dd>
<dt> &lsquo;<samp>french-calendar-day-name-array</samp>&rsquo;</dt>
<dd><p>A list of the days in the French Revolutionary calendar.
</p></dd>
<dt> &lsquo;<samp>french-calendar-multibyte-special-days-array</samp>&rsquo;</dt>
<dd><p>A list of the special days (non weekdays) in the French 
Revolutionary calendar, using multibyte codes to represent the accented 
characters.
</p></dd>
<dt> &lsquo;<samp>french-calendar-special-days-array</samp>&rsquo;</dt>
<dd><p>A list of the special days (non weekdays) in the French Revolutionary calendar.
</p></dd>
<dt> &lsquo;<samp>coptic-calendar-month-name-array</samp>&rsquo;</dt>
<dd><p>A list of the months in the Coptic calendar.
</p></dd>
<dt> &lsquo;<samp>ethiopic-calendar-month-name-array</samp>&rsquo;</dt>
<dd><p>A list of the months in the Ethiopic calendar.
</p></dd>
<dt> &lsquo;<samp>persian-calendar-month-name-array</samp>&rsquo;</dt>
<dd><p>A list of the months in the Persian calendar.
</p></dd>
<dt> &lsquo;<samp>calendar-mayan-haab-month-name-array</samp>&rsquo;</dt>
<dt> &lsquo;<samp>calendar-mayan-tzolkin-names-array</samp>&rsquo;</dt>
</dl>

<hr size="6">
<a name="Calendar-Parsing"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Calendar-Reference" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Extending-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Guile-Modules" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Calendar-Parsing-1"></a>
<h3 class="subsection">4.2.3 Calendar Parsing</h3>
<a name="index-calendar-parsing"></a>
<a name="index-parsing_002c-calendar"></a>

<p>The calendar parsing module can be invoked as <code>(use-modules (combine_scm parse))</code>.  
</p>
<p>The most useful function in the module is <code>parse-date</code>.  It takes as arguments
a date string and an output format.  The date string is parsed as well as possible
in descending order of preference for format in case of ambiguity.  The function 
returns the date triplet (or other such representation) suggested by the format
string.
</p>
<p>The supported format strings are the words in the function names of the form 
<code>calendar-xxxx-from-absolute</code> that would take the place of the <code>xxxx</code>.
See section <a href="#Calendar-Functions">Calendar Functions</a>, for more information.
</p>
<p>The parsing of the date string depends on the setting of a couple of variables.
Look inside the file &lsquo;<samp>parse.scm</samp>&rsquo; for details.  The list <var>parse-date-expected-order</var>
lists the order in which the parser should look for the year, month, and day in case
of ambiguity.  The list <var>parse-date-method-preference</var> give more general format 
preferences, such as 8-digit, delimited, or a word for the month and the expected incoming
calendar.
</p>
<p>Here are a few examples of passing a date and putting it out in some formats:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">guile&gt; (use-modules (combine_scm parse))
guile&gt; (parse-date &quot;27 September 2003&quot; &quot;gregorian&quot;)
(9 27 2003)
guile&gt; (parse-date &quot;27 September 2003&quot; &quot;julian&quot;)
(9 14 2003)
</pre></td></tr></table>

<p>The 13 day difference in the calendars is the reason that the Orthodox Christmas
is 2 weeks after the Roman Catholic Christmas.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">guile&gt; (parse-date &quot;27 September 2003&quot; &quot;hebrew&quot;)
(7 1 5764)
</pre></td></tr></table>

<p>Note that the Hebrew date is Rosh HaShannah, the first day of the year 5764.  
The reason that the month is listed as 7 rather than 1 is inherited from the 
Emacs calendar implementation.  Using the month list in 
<var>calendar-hebrew-month-name-array-common-year</var> or 
<var>calendar-hebrew-month-name-array-leap-year</var> correctly gives &quot;Tishri&quot;, but 
since the extra month (in years that have it) comes mid-year, the programming 
choice that I carried forward was to cycle the months around so that the extra 
month would come at the end of the list.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">guile&gt; (parse-date &quot;27 September 2003&quot; &quot;islamic&quot;)
(7 30 1424)
guile&gt; (parse-date &quot;27 September 2003&quot; &quot;iso&quot;)
(39 6 2003)
</pre></td></tr></table>

<p>This is the 6th day (Saturday) of week 39 of the year.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">guile&gt; (parse-date &quot;27 September 2003&quot; &quot;mayan-long-count&quot;)
(12 19 10 11 7)
</pre></td></tr></table>

<p>I won&rsquo;t get into the detail, but the five numbers reflect the date in
the Mayan calendar as currently understood.
</p>
<p>Generally, I&rsquo;d recommend using the more specific functions if you are sure
of the date format you expect.  For comparing dates, I would further recommend
comparing the absolute day count rather than any more formatted format.
</p>
<hr size="6">
<a name="Applying-combine"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Calendar-Parsing" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Rearranging-fields" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Extending-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Future-Work" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Applying-combine-1"></a>
<h1 class="chapter">5. Applying combine</h1>

<p>There are lots of ways to apply <code>combine</code> to problems that will pop up
in the course of day-to-day life.  (Of course this fits into your day-to-day 
life a bit more if you have a job or hobby that regularly puts you into
contact with data files.)
</p>
<p>Here are a few topics explored in more detail.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Rearranging-fields">5.1 Rearranging Fields</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Aggregation">5.2 Aggregation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Finding-changes">5.3 Finding Changes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Hierarchies">5.4 Hierarchies</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Rearranging-fields"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Applying-combine" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Aggregation" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Future-Work" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Rearranging-Fields"></a>
<h2 class="section">5.1 Rearranging Fields</h2>

<p>When you do not use any reference files, <code>combine</code> still gives you the
opportunity to create a new record layout based on the records you read.
</p>
<p>This is an advantage over the <code>cut</code> utility because while <code>cut</code> 
only allows you to omit portions of the record, <code>combine</code> also allows 
you to reorder those fields you keep and to add a constant field somewhere in the
order.  In addition, <code>combine</code> gives you the chance to convert 
between fixed-width and delimited formats, where <code>cut</code> keeps the
format you started with (although the GNU version does let you change 
delimiters).
</p>
<p>Clearly, flexible tools like <code>awk</code> or <code>sed</code> or any programming
language will also make this kind of thing (and with a little work anything
<code>combine</code> can do) possible.  It may be that they are a more efficient choice,
but I have never tested it.
</p>
<p>As an example, here is a fixed width file, which contains in its record layout
some address book information.  If I need to make a tab-delimited file of
names and phone numbers to upload into my mobile phone, I can use the command
that follows to get the output I want.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">$ cat testadd.txt
2125551212Doe       John      123 Main StreetNew York  NY10001
2025551212Doe       Mary      123 Main StreetWashingtonDC20001
3015551212Doe       Larry     123 Main StreetLaurel    MD20707
6175551212Doe       Darryl    123 Main StreetBoston    MA02115
6035551212Doe       Darryl    123 Main StreetManchesterNH02020
</pre></td></tr></table>

<p>Here is a command that grabs the first and last name and the phone number
and tacks the word &quot;Home&quot; on the end so that my phone marks the number with
a little house.<a name="DOCF2" href="#FOOT2">(2)</a>
</p>
<p>Note that the statistics and the output all show up on the screen if you do 
not say otherwise.  The statistics are on <code>stderr</code> and the output on
<code>stdout</code>, so you can redirect them differently.  You can also use the 
option &lsquo;<samp>--output-file</samp>&rsquo; (or &lsquo;<samp>-t</samp>&rsquo;) to provide an output file,
and you can suppress the statistics if you want with &lsquo;<samp>--no-statistics</samp>&rsquo;.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">% combine --write-output --output-field-delimiter=&quot;	&quot; \
          --output-fields=21-30,11-20,1-10 \
          --output-constant=&quot;Home&quot; testadd.txt
Statistics for data file testadd.txt
  Number of records read:                            5
  Number of records dropped by filter:               0
  Number of records matched on key:                  5
  Number of records written:                         5
John	Doe	2125551212	Home
Mary	Doe	2025551212	Home
Larry	Doe	3015551212	Home
Darryl	Doe	6175551212	Home
Darryl	Doe	6035551212	Home
</pre></td></tr></table>

<p>The delimiter between the quotes and in the output was a tab character, and it
worked, but in some formats it comes out in a space when printed.
</p>
<p>For reference, here is a comparable SQL query that would select the same data
assuming a table were set up containing the data in the file above.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">SELECT First_Name, Last_Name, Phone_Number, 'Home'
  FROM Address_Book;
</pre></td></tr></table>

<p>A comparable <code>gawk</code> program would be something like this.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">BEGIN {OFS = &quot;\t&quot;}
{ 
  print substr ($0, 21, 10), substr ($0, 11, 10), substr ($0, 1, 10), &quot;Home&quot;;
  }
</pre></td></tr></table>

<hr size="6">
<a name="Aggregation"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Rearranging-fields" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Finding-changes" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Future-Work" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Aggregation-1"></a>
<h2 class="section">5.2 Aggregation</h2>

<p>One feature of <code>combine</code> is aggregation.  In other words, based on
a set of keys in a data file, create a new file containing a summary record
for each unique combination of values that appears in those keys.
</p>
<p>This is a special case of reference-file based output in that the reference
file and the data file are the same file.  We are using it both to build 
the list of keys and to provide the values to summarize.
</p>
<p>Here is a simple example.  Suppose my 4-year-old were flipping 
Sacajawea<a name="DOCF3" href="#FOOT3">(3)</a>
dollar coins and recording the results, along with the time and the date.
A portion of the resulting file might look like this:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">Monday	27 Oct 2003	14:02:01	Head	1.00
Monday	27 Oct 2003	14:03:05	Head	1.00
Monday	27 Oct 2003	14:03:55	Tail	1.00
Monday	27 Oct 2003	14:04:30	Head	1.00
Monday	27 Oct 2003	14:06:12	Tail	1.00
Monday	27 Oct 2003	14:08:43	Head	1.00
Monday	27 Oct 2003	14:54:52	Head	1.00
Monday	27 Oct 2003	19:59:59	Tail	1.00
Tuesday	28 Oct 2003	08:02:01	Tail	5.00
Tuesday	28 Oct 2003	08:02:16	Tail	5.00
Tuesday	28 Oct 2003	08:02:31	Head	5.00
Tuesday	28 Oct 2003	08:02:46	Tail	5.00
Wednesday	29 Oct 2003	12:02:09	Head	10.00
</pre></td></tr></table>

<p>Then if I wanted to measure her daily performance, I could count the number
of coin flips per day, with the following command.  
</p>
<p>The option &lsquo;<samp>--data-is-reference</samp>&rsquo; tells the program to read the file 
only once, bulding the list of keys as it goes.  This is useful for 
aggregations, and it requires that the key fields be the same and that
we only keep one copy of each key (with the &lsquo;<samp>--unique</samp>&rsquo; option).
</p>
<p>The records come out in an unspecified order.  If you require a specific 
order, you can pipe the result through the <code>sort</code> command.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">% combine --input-field-delimiter=&quot;	&quot; --data-is-reference \
          --count --reference-file=testcoin.txt \
          --output-field-delimiter=&quot;,&quot; -D &quot;	&quot; \
          --key-fields=2 --data-key-fields=2 --write-output \
          --output-fields=2 --unique testcoin.txt
28 Oct 2003,4
29 Oct 2003,1
27 Oct 2003,8
Statistics for reference file testcoin.txt
  Number of records read:                           13
  Number of records dropped by filter:               0
  Number of records stored:                          3
  Number of records matched on key:                  3
  Number of records matched fully:                   3
  Number of reference-data matches:                 13
</pre></td></tr></table>

<p>An equivalent SQL statement, assuming that the table has been created
would be.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">SELECT Date, COUNT (Result)
  FROM Coinflip
  GROUP BY Date;
</pre></td></tr></table>

<p>If she wanted to count the number of heads and tails, and also the 
amount she bet on each, she could do the following.  (I have shortened
the options you have already seen to their 1-byte equivalents.)
</p>
<p>The specification of the field to sum says to keep 2 decimal places.
<code>combine</code> works with integers if you don&rsquo;t say otherwise.  The
option &lsquo;<samp>--counter-size</samp>&rsquo; tells the program to use at least that
many bytes to present counters and sums.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">% combine -D &quot;	&quot; -M -n --sum-fields=5.2 --counter-size=8 \
          -r testcoin.txt -d &quot;,&quot; -D &quot;	&quot; -k 4 -m 4 -w -o 4 \
          -u testcoin.txt
Head,       7,   20.00
Tail,       6,   18.00
Statistics for reference file testcoin.txt
  Number of records read:                           13
  Number of records dropped by filter:               0
  Number of records stored:                          2
  Number of records matched on key:                  2
  Number of records matched fully:                   2
  Number of reference-data matches:                 13
</pre></td></tr></table>

<p>An equivalent SQL statement, assuming again that the table has been 
created would be.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">SELECT Result, COUNT (Result), Sum (Wager)
  FROM Coinflip
  GROUP BY Result;
</pre></td></tr></table>


<hr size="6">
<a name="Finding-changes"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Aggregation" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Hierarchies" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Future-Work" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Finding-Changes"></a>
<h2 class="section">5.3 Finding Changes</h2>

<p>If you get the same file again and again, and you want to see what&rsquo;s
different, the canonical method is to use the <code>diff</code> command.
It will list for you those records that are unique to each file, and 
those that appear to have changed.  One drawback is that it requires 
the records in the two files to be in the same order.  Another is that
it does not pay attention to the key fields that may be important to
you.
</p>
<p>When I want to find the changes in a file, including additions, 
deletions, and any changes for the information about a key I normally 
use 4 applications of <code>combine</code>.  One command is suffucuent to 
find the new keys.  One is enough to find those that are no longer there.
A third finds everything that is different, and the fourth finds the
before and after image of keys whose information has changed.
</p>
<p>As an example, suppose my bridge club&rsquo;s roster has a name and a phone 
number, separated by commas, for each member.  The following four 
commands will identify the new members, the departed members, and
those whose phone number has changed.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">%# Reference file is optional, so unmatched data records will have
%# 2 blank fields at the end.
% combine -D , -d , -w -o 1-2 -r old_roster.txt -D , -k 1 -m 1 -p \
          -o 1-2 inew_roster.txt | grep -v ' , $' &gt; new_member.txt
%# Data file is optional, so unmatched reference records will have
%# 2 blank fields at the beginning.
% combine -D , -d , -p -w -o 1-2 -r old_roster.txt -D , -k 1 -m 1 \
          -o 1-2 inew_roster.txt | grep -v '^ , ' &gt; departed_member.txt
%# Both files are optional, so any unmatched records will have
%# blank fields at the beginning or end.  Here we match on the 
%#entire record rather than the key as in the above two examples.
% combine -D , -d , -p -w -o 1-2 -r old_roster.txt -D , \
          -k 1-2 -m 1-2 -o 1-2 -p inew_roster.txt | grep -v ' , ' \
          &gt; all_changes.txt
%# Match up the before and after versions of an entry to see changes.
% combine -D , -d , -w -o 1-2 -r all_changes.txt -D , -k 3 -m 1 -o 2 \
          all_changes.txt | grep -v ' , ' &gt; changed_member.txt
</pre></td></tr></table>
<p>TO BE CONTINUED
</p>
<hr size="6">
<a name="Hierarchies"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Finding-changes" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Future-Work" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Future-Work" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Hierarchies-1"></a>
<h2 class="section">5.4 Hierarchies</h2>

<p>A hierarchy tends to be an organization where there is a directional
one-to-many relationship between parent records and their associated
children.  <code>combine</code> works with hierarchies within reference files
when the file has a record for each node and each record points to its
parent in the hierarchy.
</p>
<p>Because the hierarchy is assumed to be stored in a reference file, it
is accessed by matching to a data record.  Once an individual reference
record has been matched to the data record, its relationship to other 
records within the hierarchy is followed through the hierarchy until
there is no further to go.
</p>
<p>The standard process is to assume that the key that matched to the
data file key is at the top of the hierarchy.  When traversing the 
hierarchy, <code>combine</code> looks for the key on the current record in
the hierarchy key of other reference records.  This repeats until
there are no further linkages from one record to the next.  For each
record that is linked to the hierarchy, that record is treated as a 
reference record that matched the data record.
</p>
<p>In this section, we&rsquo;ll use the following hierarchy file.  It is a simple
hierarchy tree with &lsquo;<samp>Grandfather</samp>&rsquo; as the top node and 2 levels of
entries below.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">Grandfather,
Father,Grandfather
Uncle,Grandfather
Me,Father
Brother,Father
Cousin,Uncle
</pre></td></tr></table>

<p>If my data file consisted only of a record with the key &lsquo;<samp>Grandfather</samp>&rsquo;,
then the following command would result in the records listed after it.  
Each record written includes the entry itself and its parent.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">combine -D ',' -w -d ',' -r test1.tmp -k 1 -m 1 -a 2 -D ',' \
        -o 1-2 test2.tmp

Grandfather,   
Father,Grandfather
Me,Father
Brother,Father
Uncle,Grandfather
Cousin,Uncle
</pre></td></tr></table>

<p>If we are only interested in the endpoints (in this case all the lowest-level 
descendants of &lsquo;<samp>Grandfather</samp>&rsquo;), we can use the option &lsquo;<samp>-l</samp>&rsquo;.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">combine -D ',' -w -d ',' -r test1.tmp -k 1 -m 1 -a 2 -D ',' -o 1 \
        -l test2.tmp

Me
Brother
Cousin
</pre></td></tr></table>

<p>We can arrive at the same number of records, each containing the entire hierarchy
traversed to get to the leaf nodes, by using the option &lsquo;<samp>--flatten-hierarchy</samp>&rsquo;
(&lsquo;<samp>-F</samp>&rsquo;).  This option takes a number as an argument, and then includes 
information from that many records found in traversing the hierarchy, starting from
the record that matched the data record.  This example tells <code>combine</code> to report
three levels from the matching &lsquo;<samp>Grandfather</samp>&rsquo; record.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">combine -D ',' -w -d ',' -r test1.tmp -k 1 -m 1 -a 2 -D ',' -o 1 \
        -F 3 test2.tmp

Grandfather,Father,Me
Grandfather,Father,Brother
Grandfather,Uncle,Cousin
</pre></td></tr></table>

<p>As with other areas within <code>combine</code>, the hierarchy manipulation is extensible
through Guile.  The key fields can be modified as with any other fields.  See section <a href="#Field-Specifiers">Field-specific extensions</a>, for details.  The matches within the hierarchy 
can be further filtered, using the &lsquo;<samp>h</samp>&rsquo; suboption of the option &lsquo;<samp>-x</samp>&rsquo;.
(see section <a href="#Extending-combine">Extending <code>combine</code></a>.)  As with matches between reference records and data 
this filtering can allow you to perform fuzzy comparisons, to do more complex 
calculations to filter the match, or to decide when you have gone far enough and would 
like to stop traversing the hierarchy.
</p>
<hr size="6">
<a name="Future-Work"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Hierarchies" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#GNU-Free-Documentation-License" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Applying-combine" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#GNU-Free-Documentation-License" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Future-Work-1"></a>
<h1 class="chapter">6. Future Work</h1>

<p>Here is a short list of things that we think will be useful in the near
future:
</p>
<p>Indexed files.  Add the ability to work with a reference file through an
index rather than loading the whole thing into a hash table.  Open
questions are the format of the index and whether to put the entire
index into memory, or work with it from disk.
</p>
<hr size="6">
<a name="GNU-Free-Documentation-License"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Future-Work" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Future-Work" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="GNU-Free-Documentation-License-1"></a>
<h1 class="appendix">A. GNU Free Documentation License</h1>

<p align="center"> Version 1.3, 3 November 2008
</p>

<table><tr><td>&nbsp;</td><td><pre class="display">Copyright &copy; 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.
<a href="http://fsf.org/">http://fsf.org/</a>

Everyone is permitted to copy and distribute verbatim copies
of this license document, but changing it is not allowed.
</pre></td></tr></table>

<ol>
<li>
PREAMBLE

<p>The purpose of this License is to make a manual, textbook, or other
functional and useful document <em>free</em> in the sense of freedom: to
assure everyone the effective freedom to copy and redistribute it,
with or without modifying it, either commercially or noncommercially.
Secondarily, this License preserves for the author and publisher a way
to get credit for their work, while not being considered responsible
for modifications made by others.
</p>
<p>This License is a kind of &ldquo;copyleft&rdquo;, which means that derivative
works of the document must themselves be free in the same sense.  It
complements the GNU General Public License, which is a copyleft
license designed for free software.
</p>
<p>We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free
program should come with manuals providing the same freedoms that the
software does.  But this License is not limited to software manuals;
it can be used for any textual work, regardless of subject matter or
whether it is published as a printed book.  We recommend this License
principally for works whose purpose is instruction or reference.
</p>
</li><li>
APPLICABILITY AND DEFINITIONS

<p>This License applies to any manual or other work, in any medium, that
contains a notice placed by the copyright holder saying it can be
distributed under the terms of this License.  Such a notice grants a
world-wide, royalty-free license, unlimited in duration, to use that
work under the conditions stated herein.  The &ldquo;Document&rdquo;, below,
refers to any such manual or work.  Any member of the public is a
licensee, and is addressed as &ldquo;you&rdquo;.  You accept the license if you
copy, modify or distribute the work in a way requiring permission
under copyright law.
</p>
<p>A &ldquo;Modified Version&rdquo; of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.
</p>
<p>A &ldquo;Secondary Section&rdquo; is a named appendix or a front-matter section
of the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document&rsquo;s overall
subject (or to related matters) and contains nothing that could fall
directly within that overall subject.  (Thus, if the Document is in
part a textbook of mathematics, a Secondary Section may not explain
any mathematics.)  The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding
them.
</p>
<p>The &ldquo;Invariant Sections&rdquo; are certain Secondary Sections whose titles
are designated, as being those of Invariant Sections, in the notice
that says that the Document is released under this License.  If a
section does not fit the above definition of Secondary then it is not
allowed to be designated as Invariant.  The Document may contain zero
Invariant Sections.  If the Document does not identify any Invariant
Sections then there are none.
</p>
<p>The &ldquo;Cover Texts&rdquo; are certain short passages of text that are listed,
as Front-Cover Texts or Back-Cover Texts, in the notice that says that
the Document is released under this License.  A Front-Cover Text may
be at most 5 words, and a Back-Cover Text may be at most 25 words.
</p>
<p>A &ldquo;Transparent&rdquo; copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the
general public, that is suitable for revising the document
straightforwardly with generic text editors or (for images composed of
pixels) generic paint programs or (for drawings) some widely available
drawing editor, and that is suitable for input to text formatters or
for automatic translation to a variety of formats suitable for input
to text formatters.  A copy made in an otherwise Transparent file
format whose markup, or absence of markup, has been arranged to thwart
or discourage subsequent modification by readers is not Transparent.
An image format is not Transparent if used for any substantial amount
of text.  A copy that is not &ldquo;Transparent&rdquo; is called &ldquo;Opaque&rdquo;.
</p>
<p>Examples of suitable formats for Transparent copies include plain
ASCII without markup, Texinfo input format, LaTeX input
format, SGML or XML using a publicly available
DTD, and standard-conforming simple HTML,
PostScript or PDF designed for human modification.  Examples
of transparent image formats include PNG, XCF and
JPG.  Opaque formats include proprietary formats that can be
read and edited only by proprietary word processors, SGML or
XML for which the DTD and/or processing tools are
not generally available, and the machine-generated HTML,
PostScript or PDF produced by some word processors for
output purposes only.
</p>
<p>The &ldquo;Title Page&rdquo; means, for a printed book, the title page itself,
plus such following pages as are needed to hold, legibly, the material
this License requires to appear in the title page.  For works in
formats which do not have any title page as such, &ldquo;Title Page&rdquo; means
the text near the most prominent appearance of the work&rsquo;s title,
preceding the beginning of the body of the text.
</p>
<p>The &ldquo;publisher&rdquo; means any person or entity that distributes copies
of the Document to the public.
</p>
<p>A section &ldquo;Entitled XYZ&rdquo; means a named subunit of the Document whose
title either is precisely XYZ or contains XYZ in parentheses following
text that translates XYZ in another language.  (Here XYZ stands for a
specific section name mentioned below, such as &ldquo;Acknowledgements&rdquo;,
&ldquo;Dedications&rdquo;, &ldquo;Endorsements&rdquo;, or &ldquo;History&rdquo;.)  To &ldquo;Preserve the Title&rdquo;
of such a section when you modify the Document means that it remains a
section &ldquo;Entitled XYZ&rdquo; according to this definition.
</p>
<p>The Document may include Warranty Disclaimers next to the notice which
states that this License applies to the Document.  These Warranty
Disclaimers are considered to be included by reference in this
License, but only as regards disclaiming warranties: any other
implication that these Warranty Disclaimers may have is void and has
no effect on the meaning of this License.
</p>
</li><li>
VERBATIM COPYING

<p>You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies
to the Document are reproduced in all copies, and that you add no other
conditions whatsoever to those of this License.  You may not use
technical measures to obstruct or control the reading or further
copying of the copies you make or distribute.  However, you may accept
compensation in exchange for copies.  If you distribute a large enough
number of copies you must also follow the conditions in section 3.
</p>
<p>You may also lend copies, under the same conditions stated above, and
you may publicly display copies.
</p>
</li><li>
COPYING IN QUANTITY

<p>If you publish printed copies (or copies in media that commonly have
printed covers) of the Document, numbering more than 100, and the
Document&rsquo;s license notice requires Cover Texts, you must enclose the
copies in covers that carry, clearly and legibly, all these Cover
Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
the back cover.  Both covers must also clearly and legibly identify
you as the publisher of these copies.  The front cover must present
the full title with all words of the title equally prominent and
visible.  You may add other material on the covers in addition.
Copying with changes limited to the covers, as long as they preserve
the title of the Document and satisfy these conditions, can be treated
as verbatim copying in other respects.
</p>
<p>If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.
</p>
<p>If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy
a computer-network location from which the general network-using
public has access to download using public-standard network protocols
a complete Transparent copy of the Document, free of added material.
If you use the latter option, you must take reasonably prudent steps,
when you begin distribution of Opaque copies in quantity, to ensure
that this Transparent copy will remain thus accessible at the stated
location until at least one year after the last time you distribute an
Opaque copy (directly or through your agents or retailers) of that
edition to the public.
</p>
<p>It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to give
them a chance to provide you with an updated version of the Document.
</p>
</li><li>
MODIFICATIONS

<p>You may copy and distribute a Modified Version of the Document under
the conditions of sections 2 and 3 above, provided that you release
the Modified Version under precisely this License, with the Modified
Version filling the role of the Document, thus licensing distribution
and modification of the Modified Version to whoever possesses a copy
of it.  In addition, you must do these things in the Modified Version:
</p>
<ol>
<li>
Use in the Title Page (and on the covers, if any) a title distinct
from that of the Document, and from those of previous versions
(which should, if there were any, be listed in the History section
of the Document).  You may use the same title as a previous version
if the original publisher of that version gives permission.

</li><li>
List on the Title Page, as authors, one or more persons or entities
responsible for authorship of the modifications in the Modified
Version, together with at least five of the principal authors of the
Document (all of its principal authors, if it has fewer than five),
unless they release you from this requirement.

</li><li>
State on the Title page the name of the publisher of the
Modified Version, as the publisher.

</li><li>
Preserve all the copyright notices of the Document.

</li><li>
Add an appropriate copyright notice for your modifications
adjacent to the other copyright notices.

</li><li>
Include, immediately after the copyright notices, a license notice
giving the public permission to use the Modified Version under the
terms of this License, in the form shown in the Addendum below.

</li><li>
Preserve in that license notice the full lists of Invariant Sections
and required Cover Texts given in the Document&rsquo;s license notice.

</li><li>
Include an unaltered copy of this License.

</li><li>
Preserve the section Entitled &ldquo;History&rdquo;, Preserve its Title, and add
to it an item stating at least the title, year, new authors, and
publisher of the Modified Version as given on the Title Page.  If
there is no section Entitled &ldquo;History&rdquo; in the Document, create one
stating the title, year, authors, and publisher of the Document as
given on its Title Page, then add an item describing the Modified
Version as stated in the previous sentence.

</li><li>
Preserve the network location, if any, given in the Document for
public access to a Transparent copy of the Document, and likewise
the network locations given in the Document for previous versions
it was based on.  These may be placed in the &ldquo;History&rdquo; section.
You may omit a network location for a work that was published at
least four years before the Document itself, or if the original
publisher of the version it refers to gives permission.

</li><li>
For any section Entitled &ldquo;Acknowledgements&rdquo; or &ldquo;Dedications&rdquo;, Preserve
the Title of the section, and preserve in the section all the
substance and tone of each of the contributor acknowledgements and/or
dedications given therein.

</li><li>
Preserve all the Invariant Sections of the Document,
unaltered in their text and in their titles.  Section numbers
or the equivalent are not considered part of the section titles.

</li><li>
Delete any section Entitled &ldquo;Endorsements&rdquo;.  Such a section
may not be included in the Modified Version.

</li><li>
Do not retitle any existing section to be Entitled &ldquo;Endorsements&rdquo; or
to conflict in title with any Invariant Section.

</li><li>
Preserve any Warranty Disclaimers.
</li></ol>

<p>If the Modified Version includes new front-matter sections or
appendices that qualify as Secondary Sections and contain no material
copied from the Document, you may at your option designate some or all
of these sections as invariant.  To do this, add their titles to the
list of Invariant Sections in the Modified Version&rsquo;s license notice.
These titles must be distinct from any other section titles.
</p>
<p>You may add a section Entitled &ldquo;Endorsements&rdquo;, provided it contains
nothing but endorsements of your Modified Version by various
parties&mdash;for example, statements of peer review or that the text has
been approved by an organization as the authoritative definition of a
standard.
</p>
<p>You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version.  Only one passage of
Front-Cover Text and one of Back-Cover Text may be added by (or
through arrangements made by) any one entity.  If the Document already
includes a cover text for the same cover, previously added by you or
by arrangement made by the same entity you are acting on behalf of,
you may not add another; but you may replace the old one, on explicit
permission from the previous publisher that added the old one.
</p>
<p>The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.
</p>
</li><li>
COMBINING DOCUMENTS

<p>You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its
license notice, and that you preserve all their Warranty Disclaimers.
</p>
<p>The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy.  If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by
adding at the end of it, in parentheses, the name of the original
author or publisher of that section if known, or else a unique number.
Make the same adjustment to the section titles in the list of
Invariant Sections in the license notice of the combined work.
</p>
<p>In the combination, you must combine any sections Entitled &ldquo;History&rdquo;
in the various original documents, forming one section Entitled
&ldquo;History&rdquo;; likewise combine any sections Entitled &ldquo;Acknowledgements&rdquo;,
and any sections Entitled &ldquo;Dedications&rdquo;.  You must delete all
sections Entitled &ldquo;Endorsements.&rdquo;
</p>
</li><li>
COLLECTIONS OF DOCUMENTS

<p>You may make a collection consisting of the Document and other documents
released under this License, and replace the individual copies of this
License in the various documents with a single copy that is included in
the collection, provided that you follow the rules of this License for
verbatim copying of each of the documents in all other respects.
</p>
<p>You may extract a single document from such a collection, and distribute
it individually under this License, provided you insert a copy of this
License into the extracted document, and follow this License in all
other respects regarding verbatim copying of that document.
</p>
</li><li>
AGGREGATION WITH INDEPENDENT WORKS

<p>A compilation of the Document or its derivatives with other separate
and independent documents or works, in or on a volume of a storage or
distribution medium, is called an &ldquo;aggregate&rdquo; if the copyright
resulting from the compilation is not used to limit the legal rights
of the compilation&rsquo;s users beyond what the individual works permit.
When the Document is included in an aggregate, this License does not
apply to the other works in the aggregate which are not themselves
derivative works of the Document.
</p>
<p>If the Cover Text requirement of section 3 is applicable to these
copies of the Document, then if the Document is less than one half of
the entire aggregate, the Document&rsquo;s Cover Texts may be placed on
covers that bracket the Document within the aggregate, or the
electronic equivalent of covers if the Document is in electronic form.
Otherwise they must appear on printed covers that bracket the whole
aggregate.
</p>
</li><li>
TRANSLATION

<p>Translation is considered a kind of modification, so you may
distribute translations of the Document under the terms of section 4.
Replacing Invariant Sections with translations requires special
permission from their copyright holders, but you may include
translations of some or all Invariant Sections in addition to the
original versions of these Invariant Sections.  You may include a
translation of this License, and all the license notices in the
Document, and any Warranty Disclaimers, provided that you also include
the original English version of this License and the original versions
of those notices and disclaimers.  In case of a disagreement between
the translation and the original version of this License or a notice
or disclaimer, the original version will prevail.
</p>
<p>If a section in the Document is Entitled &ldquo;Acknowledgements&rdquo;,
&ldquo;Dedications&rdquo;, or &ldquo;History&rdquo;, the requirement (section 4) to Preserve
its Title (section 1) will typically require changing the actual
title.
</p>
</li><li>
TERMINATION

<p>You may not copy, modify, sublicense, or distribute the Document
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense, or distribute it is void, and
will automatically terminate your rights under this License.
</p>
<p>However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally
terminates your license, and (b) permanently, if the copyright holder
fails to notify you of the violation by some reasonable means prior to
60 days after the cessation.
</p>
<p>Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.
</p>
<p>Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, receipt of a copy of some or all of the same material does
not give you any rights to use it.
</p>
</li><li>
FUTURE REVISIONS OF THIS LICENSE

<p>The Free Software Foundation may publish new, revised versions
of the GNU Free Documentation License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.  See
<a href="http://www.gnu.org/copyleft/">http://www.gnu.org/copyleft/</a>.
</p>
<p>Each version of the License is given a distinguishing version number.
If the Document specifies that a particular numbered version of this
License &ldquo;or any later version&rdquo; applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation.  If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation.  If the Document
specifies that a proxy can decide which future versions of this
License can be used, that proxy&rsquo;s public statement of acceptance of a
version permanently authorizes you to choose that version for the
Document.
</p>
</li><li>
RELICENSING

<p>&ldquo;Massive Multiauthor Collaboration Site&rdquo; (or &ldquo;MMC Site&rdquo;) means any
World Wide Web server that publishes copyrightable works and also
provides prominent facilities for anybody to edit those works.  A
public wiki that anybody can edit is an example of such a server.  A
&ldquo;Massive Multiauthor Collaboration&rdquo; (or &ldquo;MMC&rdquo;) contained in the
site means any set of copyrightable works thus published on the MMC
site.
</p>
<p>&ldquo;CC-BY-SA&rdquo; means the Creative Commons Attribution-Share Alike 3.0
license published by Creative Commons Corporation, a not-for-profit
corporation with a principal place of business in San Francisco,
California, as well as future copyleft versions of that license
published by that same organization.
</p>
<p>&ldquo;Incorporate&rdquo; means to publish or republish a Document, in whole or
in part, as part of another Document.
</p>
<p>An MMC is &ldquo;eligible for relicensing&rdquo; if it is licensed under this
License, and if all works that were first published under this License
somewhere other than this MMC, and subsequently incorporated in whole
or in part into the MMC, (1) had no cover texts or invariant sections,
and (2) were thus incorporated prior to November 1, 2008.
</p>
<p>The operator of an MMC Site may republish an MMC contained in the site
under CC-BY-SA on the same site at any time before August 1, 2009,
provided the MMC is eligible for relicensing.
</p>
</li></ol>


<a name="ADDENDUM_003a-How-to-use-this-License-for-your-documents"></a>
<h2 class="heading">ADDENDUM: How to use this License for your documents</h2>

<p>To use this License in a document you have written, include a copy of
the License in the document and put the following copyright and
license notices just after the title page:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">  Copyright (C)  <var>year</var>  <var>your name</var>.
  Permission is granted to copy, distribute and/or modify this document
  under the terms of the GNU Free Documentation License, Version 1.3
  or any later version published by the Free Software Foundation;
  with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
  Texts.  A copy of the license is included in the section entitled ``GNU
  Free Documentation License''.
</pre></td></tr></table>

<p>If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
replace the &ldquo;with&hellip;Texts.&rdquo; line with this:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">    with the Invariant Sections being <var>list their titles</var>, with
    the Front-Cover Texts being <var>list</var>, and with the Back-Cover Texts
    being <var>list</var>.
</pre></td></tr></table>

<p>If you have Invariant Sections without Cover Texts, or some other
combination of the three, merge those two alternatives to suit the
situation.
</p>
<p>If your document contains nontrivial examples of program code, we
recommend releasing these examples in parallel under your choice of
free software license, such as the GNU General Public License,
to permit their use in free software.
</p>

<hr size="6">
<a name="Index"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#GNU-Free-Documentation-License" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[ &gt; ]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#GNU-Free-Documentation-License" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[ &gt;&gt; ]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Index-1"></a>
<h1 class="unnumbered">Index</h1>

<table><tr><th valign="top">Jump to: &nbsp; </th><td><a href="#Index-1_cp_letter-C" class="summary-letter"><b>C</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-D" class="summary-letter"><b>D</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-E" class="summary-letter"><b>E</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-F" class="summary-letter"><b>F</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-G" class="summary-letter"><b>G</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-M" class="summary-letter"><b>M</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-O" class="summary-letter"><b>O</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-P" class="summary-letter"><b>P</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-R" class="summary-letter"><b>R</b></a>
 &nbsp; 
</td></tr></table>
<table border="0" class="index-cp">
<tr><td></td><th align="left">Index Entry</th><th align="left"> Section</th></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Index-1_cp_letter-C">C</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-calendar-functions">calendar functions</a></td><td valign="top"><a href="#Calendar-Functions">4.2.1 Calendar Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-calendar-parsing">calendar parsing</a></td><td valign="top"><a href="#Calendar-Parsing">4.2.3 Calendar Parsing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-calendar-reference">calendar reference</a></td><td valign="top"><a href="#Calendar-Reference">4.2.2 Calendar Reference</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Index-1_cp_letter-D">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-data-file">data file</a></td><td valign="top"><a href="#Data-Files">2.3 Data Files</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Index-1_cp_letter-E">E</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-extension-options">extension options</a></td><td valign="top"><a href="#Extension-Options">4.1 Extension Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extensions_002c-calendar">extensions, calendar</a></td><td valign="top"><a href="#Calendar-Functions">4.2.1 Calendar Functions</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Index-1_cp_letter-F">F</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-file-options">file options</a></td><td valign="top"><a href="#File-Options">2.2 File Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file-structure-options">file structure options</a></td><td valign="top"><a href="#File-Options">2.2 File Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002c-data">file, data</a></td><td valign="top"><a href="#Data-Files">2.3 Data Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002c-reference">file, reference</a></td><td valign="top"><a href="#Reference-Files">2.4 Reference Files</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Index-1_cp_letter-G">G</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-general-options">general options</a></td><td valign="top"><a href="#General-Options">2.1 General Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-guile-modules">guile modules</a></td><td valign="top"><a href="#Guile-Modules">4.2 Guile Modules</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Index-1_cp_letter-M">M</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-modules_002c-calendar">modules, calendar</a></td><td valign="top"><a href="#Calendar-Functions">4.2.1 Calendar Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-modules_002c-guile">modules, guile</a></td><td valign="top"><a href="#Guile-Modules">4.2 Guile Modules</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Index-1_cp_letter-O">O</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-options_002c-data-file">options, data file</a></td><td valign="top"><a href="#Data-Files">2.3 Data Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-options_002c-extension">options, extension</a></td><td valign="top"><a href="#Extension-Options">4.1 Extension Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-options_002c-file">options, file</a></td><td valign="top"><a href="#File-Options">2.2 File Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-options_002c-file-structure">options, file structure</a></td><td valign="top"><a href="#File-Options">2.2 File Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-options_002c-general">options, general</a></td><td valign="top"><a href="#General-Options">2.1 General Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-options_002c-reference-file">options, reference file</a></td><td valign="top"><a href="#Reference-Files">2.4 Reference Files</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Index-1_cp_letter-P">P</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-parsing_002c-calendar">parsing, calendar</a></td><td valign="top"><a href="#Calendar-Parsing">4.2.3 Calendar Parsing</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Index-1_cp_letter-R">R</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-reference-file">reference file</a></td><td valign="top"><a href="#Reference-Files">2.4 Reference Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-reference-strings_002c-calendar">reference strings, calendar</a></td><td valign="top"><a href="#Calendar-Reference">4.2.2 Calendar Reference</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a href="#Index-1_cp_letter-C" class="summary-letter"><b>C</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-D" class="summary-letter"><b>D</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-E" class="summary-letter"><b>E</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-F" class="summary-letter"><b>F</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-G" class="summary-letter"><b>G</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-M" class="summary-letter"><b>M</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-O" class="summary-letter"><b>O</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-P" class="summary-letter"><b>P</b></a>
 &nbsp; 
<a href="#Index-1_cp_letter-R" class="summary-letter"><b>R</b></a>
 &nbsp; 
</td></tr></table>


<hr size="6">
<a name="SEC_Foot"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1>Footnotes</h1>
<h3><a name="FOOT1" href="#DOCF1">(1)</a></h3>
<p>That&rsquo;s not strictly true.  I discovered the
other day that I can create variables in some extension commands and
then use them in a subsequent command.  That requires a little
documentation of the order of processing so you get the values you want,
but I haven&rsquo;t done that yet.  For now, you can know that a set of field
specifiers of the same type (like output fields for reference file 1 or
sum fields from the data file) are processed in order.
</p><h3><a name="FOOT2" href="#DOCF2">(2)</a></h3>
<p>As of this writing, my current phone doesn&rsquo;t mark 
numbers with a house any longer.
</p><h3><a name="FOOT3" href="#DOCF3">(3)</a></h3>
<p>As of this writing, presidential dollar coins are more 
common, but these and the older Susan B. Anthony coins still show up.
</p><hr size="1">
<a name="SEC_Contents"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1>Table of Contents</h1>
<div class="contents">

<ul class="toc">
  <li><a name="toc-Overview-of-combine" href="#Overview">1. Overview of <code>combine</code></a>
  <ul class="toc">
    <li><a name="toc-Introduction-1" href="#Introduction">1.1 Introduction</a>
    <ul class="toc">
      <li><a name="toc-Ways-to-Use-combine-1" href="#Ways-to-Use-combine">1.1.1 Ways to Use <code>combine</code></a>
      <ul class="toc">
        <li><a name="toc-Encrypted-Data-1" href="#Encrypted-Data">1.1.1.1 Encrypted Data</a></li>
        <li><a name="toc-Data-Validation-1" href="#Data-Validation">1.1.1.2 Data Validation</a></li>
      </ul>
</li>
    </ul></li>
    <li><a name="toc-Reporting-Bugs-1" href="#Reporting-Bugs">1.2 Reporting Bugs</a></li>
  </ul></li>
  <li><a name="toc-Invoking-combine-1" href="#Invoking-combine">2. Invoking <code>combine</code></a>
  <ul class="toc">
    <li><a name="toc-General-Options-1" href="#General-Options">2.1 General Options</a></li>
    <li><a name="toc-File-Options-1" href="#File-Options">2.2 File Options</a></li>
    <li><a name="toc-Data-Files-1" href="#Data-Files">2.3 Data Files</a></li>
    <li><a name="toc-Reference-Files-1" href="#Reference-Files">2.4 Reference Files</a></li>
    <li><a name="toc-Output-Files-1" href="#Output-Files">2.5 Output Files</a></li>
    <li><a name="toc-Field-Specifiers-1" href="#Field-Specifiers">2.6 Field Specifiers</a></li>
    <li><a name="toc-Emulation-1" href="#Emulation">2.7 Emulation</a></li>
  </ul></li>
  <li><a name="toc-How-combine-Processes-Files-1" href="#How-combine-Processes-Files">3. How <code>combine</code> Processes Files</a></li>
  <li><a name="toc-Extending-combine-1" href="#Extending-combine">4. Extending <code>combine</code></a>
  <ul class="toc">
    <li><a name="toc-Extension-Options-1" href="#Extension-Options">4.1 Extension Options</a></li>
    <li><a name="toc-Guile-Modules-1" href="#Guile-Modules">4.2 Guile Modules</a>
    <ul class="toc">
      <li><a name="toc-Calendar-Functions-1" href="#Calendar-Functions">4.2.1 Calendar Functions</a></li>
      <li><a name="toc-Calendar-Reference-1" href="#Calendar-Reference">4.2.2 Calendar Reference</a></li>
      <li><a name="toc-Calendar-Parsing-1" href="#Calendar-Parsing">4.2.3 Calendar Parsing</a></li>
    </ul>
</li>
  </ul></li>
  <li><a name="toc-Applying-combine-1" href="#Applying-combine">5. Applying combine</a>
  <ul class="toc">
    <li><a name="toc-Rearranging-Fields" href="#Rearranging-fields">5.1 Rearranging Fields</a></li>
    <li><a name="toc-Aggregation-1" href="#Aggregation">5.2 Aggregation</a></li>
    <li><a name="toc-Finding-Changes" href="#Finding-changes">5.3 Finding Changes</a></li>
    <li><a name="toc-Hierarchies-1" href="#Hierarchies">5.4 Hierarchies</a></li>
  </ul></li>
  <li><a name="toc-Future-Work-1" href="#Future-Work">6. Future Work</a></li>
  <li><a name="toc-GNU-Free-Documentation-License-1" href="#GNU-Free-Documentation-License">A. GNU Free Documentation License</a></li>
  <li><a name="toc-Index-1" href="#Index">Index</a></li>
</ul>
</div>
<hr size="1">
<a name="SEC_About"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1>About This Document</h1>
<p>
  This document was generated by <em>Daniel P. Valentine</em> on <em>July 28, 2013</em> using <a href="http://www.nongnu.org/texi2html/"><em>texi2html 1.82</em></a>.
</p>
<p>
  The buttons in the navigation panels have the following meaning:
</p>
<table border="1">
  <tr>
    <th> Button </th>
    <th> Name </th>
    <th> Go to </th>
    <th> From 1.2.3 go to</th>
  </tr>
  <tr>
    <td align="center"> [ &lt; ] </td>
    <td align="center">Back</td>
    <td>Previous section in reading order</td>
    <td>1.2.2</td>
  </tr>
  <tr>
    <td align="center"> [ &gt; ] </td>
    <td align="center">Forward</td>
    <td>Next section in reading order</td>
    <td>1.2.4</td>
  </tr>
  <tr>
    <td align="center"> [ &lt;&lt; ] </td>
    <td align="center">FastBack</td>
    <td>Beginning of this chapter or previous chapter</td>
    <td>1</td>
  </tr>
  <tr>
    <td align="center"> [ Up ] </td>
    <td align="center">Up</td>
    <td>Up section</td>
    <td>1.2</td>
  </tr>
  <tr>
    <td align="center"> [ &gt;&gt; ] </td>
    <td align="center">FastForward</td>
    <td>Next chapter</td>
    <td>2</td>
  </tr>
  <tr>
    <td align="center"> [Top] </td>
    <td align="center">Top</td>
    <td>Cover (top) of document</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [Contents] </td>
    <td align="center">Contents</td>
    <td>Table of contents</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [Index] </td>
    <td align="center">Index</td>
    <td>Index</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [ ? ] </td>
    <td align="center">About</td>
    <td>About (help)</td>
    <td> &nbsp; </td>
  </tr>
</table>

<p>
  where the <strong> Example </strong> assumes that the current position is at <strong> Subsubsection One-Two-Three </strong> of a document of the following structure:
</p>

<ul>
  <li> 1. Section One
    <ul>
      <li>1.1 Subsection One-One
        <ul>
          <li>...</li>
        </ul>
      </li>
      <li>1.2 Subsection One-Two
        <ul>
          <li>1.2.1 Subsubsection One-Two-One</li>
          <li>1.2.2 Subsubsection One-Two-Two</li>
          <li>1.2.3 Subsubsection One-Two-Three &nbsp; &nbsp;
            <strong>&lt;== Current Position </strong></li>
          <li>1.2.4 Subsubsection One-Two-Four</li>
        </ul>
      </li>
      <li>1.3 Subsection One-Three
        <ul>
          <li>...</li>
        </ul>
      </li>
      <li>1.4 Subsection One-Four</li>
    </ul>
  </li>
</ul>

<hr size="1">
<p>
 <font size="-1">
  This document was generated by <em>Daniel P. Valentine</em> on <em>July 28, 2013</em> using <a href="http://www.nongnu.org/texi2html/"><em>texi2html 1.82</em></a>.
 </font>
 <br>

</p>
</body>
</html>
